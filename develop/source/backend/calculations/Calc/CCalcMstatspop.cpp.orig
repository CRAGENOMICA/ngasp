/*
 * mstatspop, Statistical Analysis using Multiple Populations for Genomic Data.
 * Copyright (c) 2009-2017, SebastiÃ¡n Ramos Onsins,
 * Centre for Research in Agricultural Genomics.
 * All rights reserved.
 *
 * This library is free software; you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License version
 * 2.1 as published by the Free Software Foundation.
 * 
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Lesser General Public License version 2.1 for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License version 2.1 along with this library; if not, write to the
 * Free Software Foundation, Inc., 51 Franklin Street - Fifth Floor,
 * Boston, MA 02110-1301, USA.
 */
/**
 *  \brief     CCalcMstatspop.cpp
 *  \details
 *  \author    jjene
 *  \version   1.0
 *  \date      July 16, 2015
 *  \pre
 *  \bug
 *  \warning   Do not use std::cout in this calculation.
 *             Use fprintf(manager()->foutput(), message) instead.
 *             std::cout works but all mstatspop calculations use fprintf
 *             so, only one function must be used.
 */

#include "CCalcMstatspop.h"

#include <cmath>
#include <string>
#include <vector>
#include <stdlib.h>     /* srand, rand */

#include "../../language/CStringTable.h"
#include "../../data_manager/common/CDataAccess.h"
#include "../../util/CFile.h"

// =============================================================================
// CALCULATIONS
// =============================================================================
#include "../../calculations/CAllCalculations.h"
#include "../../calculations/Calc/CCalcOpenFastaFile.h"
#include "../../calculations/Calc/CCalcMstatspopOpenFastaFile.h"
#include "../../calculations/Calc/CCalcMstatspopOpenMsFile.h"
#include "../../calculations/Calc/CCalcFasta2DnaMatrix.h"
#include "../../calculations/Calc/CCalcDnaMatrix2MatrixPol.h"
#include "../../calculations/Calc/CCalcTOptimalTests.h"
#include "../../calculations/Calc/CCalcR2.h"
#include "../../calculations/Calc/CCalcR2p.h"
#include "../../calculations/Calc/CCalcFreqStats.h"
#include "../../calculations/Calc/CCalcMismatch.h"
#include "../../calculations/Calc/CCalcSxsfss.h"
#include "../../calculations/Calc/CCalcJointFreqDist.h"
#include "../../calculations/Calc/CCalcPiwpiafst.h"
#include "../../calculations/Calc/CCalcHwhafsth.h"
#include "../../calculations/Calc/CCalcFs.h"
#include "../../calculations/Calc/CCalcPermute.h"
#include "../../calculations/Calc/CCalcGFF.h"
#include "../../calculations/Calc/CCalcFileStats.h"
#include "../../calculations/Calc/CCalcOpenFreqSpecFile.h"
#include "../../calculations/Calc/CCalcMaskFileMs.h"
#include "../../calculations/Calc/CCalcEffecNucAndTCGAFreqs.h"
#include "../../calculations/Calc/CCalcLengthamngAndCalcs.h"
#include "../../calculations/Calc/CCalcX.h"
#include "../../calculations/Calc/CCalcY.h"
#include "../../calculations/Calc/CCalcZ.h"
#include "../../calculations/Calc/CCalcArrayOpeX.h"
#include "../../calculations/Calc/CCalcMstatspopOutput.h"
#include "../../calculations/Calc/CCalcOpenTFastaFile.h"
#include "../../calculations/Calc/CCalcOpenEffectSizesFile.h"
#include "../../calculations/Calc/CCalcOpenCoordinatesFile.h"
#include "../../calculations/Calc/CCalcOpenWeightPositionsFile.h"

// =============================================================================
// DATA TYPES
// =============================================================================
#include "../../data_manager/CDataManager.h"
#include "../../data_manager/Data/CDataChar.h"
#include "../../data_manager/Data/CDataCharVector.h"
#include "../../data_manager/Data/CDataCharMatrix.h"
#include "../../data_manager/Data/CDataInt.h"
#include "../../data_manager/Data/CDataIntVector.h"
#include "../../data_manager/Data/CDataIntMatrix.h"
#include "../../data_manager/Data/CDataInt64.h"
#include "../../data_manager/Data/CDataInt64Vector.h"
#include "../../data_manager/Data/CDataInt64Matrix.h"
#include "../../data_manager/Data/CDataFloat.h"
#include "../../data_manager/Data/CDataFloatVector.h"
#include "../../data_manager/Data/CDataDouble.h"
#include "../../data_manager/Data/CDataDoubleVector.h"
#include "../../data_manager/Data/CDataDoubleMatrix.h"
#include "../../data_manager/Data/CDataDoubleCube.h"
#include "../../data_manager/Data/CDataStdString.h"
#include "../../data_manager/Data/CDataStringSet.h"

#include "../../commands/CAllCommands.h"

CCalcMstatspop::CCalcMstatspop()
: ICalculation(KeyString::CALC_MSTATSPOP,
               KeyString::CALC_MSTATSPOP_BRIEF_DESC,
               KeyString::CALC_MSTATSPOP_DESC,
               KeyString::NGASP_AUTHORS,
               KeyString::MSTATSPOP_COPYRIGHT,
               KeyString::GENERIC_CITATIONS,
               KeyString::UNDEFINED_STRING) {
  BEGIN_CALCULATION_INTERFACE_DEFINITION
    SET_INPUT_INFO(populations_initial_,                                        // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_POPULATIONS_INITIAL_,                         // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(ploidy_,                                                     // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_PLOIDY_,                                      // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(b_include_unknown_,                                          // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_INCLUDE_UNKNOWN_,                             // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(file_out_,                                                   // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_FILE_OUT_,                                    // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(b_force_outgroup_,                                           // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_FORCE_OUTGROUP_,                              // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(b_outgroup_presence_,                                        // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_OUTGROUP_PRESENCE_,                           // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(vint_perpop_nsam_,                                           // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_VINT_PERPOP_NSAM_,                            // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(npops_,                                                      // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_NPOPS_,                                       // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(formatfile_,                                                 // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_FORMATFILE_,                                  // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(r2i_ploidies_,                                               // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_R2I_PLOIDIES_,                                // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(file_mas_,                                                   // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_FILE_MAS_,                                    // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(niter_,                                                      // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_NITER_,                                       // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(niterdata_,                                                  // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_NITERDATA_,                                   // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(b_H0frq_,                                                    // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_H0FRQ_,                                       // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(b_H1frq_,                                                    // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_H1FRQ_,                                       // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(numPloidies_,                                                // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_NUMPLOIDIES_,                                 // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(ms_svratio_,                                                 // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_MS_SVRATIO_,                                  // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(length_,                                                     // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_LENGTH_,                                      // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(length_al_,                                                  // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_LENGTH_AL_,                                   // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(freq_revert_,                                                // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_FREQ_REVERT_,                                 // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(b_gfffiles_,                                                 // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_GFFFILES_,                                    // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(file_GFF_,                                                   // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_FILE_GFF_,                                    // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(subset_positions_,                                           // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_SUBSET_POSITIONS_,                            // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(code_name_,                                                  // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_CODE_NAME_,                                   // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(genetic_code_,                                               // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_GENETIC_CODE_,                                // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(file_H0f_,                                                   // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_FILE_H0F_,                                    // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(file_H1f_,                                                   // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_FILE_H1F_,                                    // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(criteria_transcript_,                                        // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_CRITERIA_TRANSCRIPT_,                         // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(all_command_line_,                                           // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_ALL_COMMAND_LINE_,                            // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(file_in_,                                                    // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_FILE_IN_,                                     // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(sort_nsam_,                                                  // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_SORT_NSAM_,                                   // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(output_,                                                     // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_OUTPUT_,                                      // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(seed_,                                                       // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_SEED_,                                        // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(file_wps_,                                                   // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_FILE_WPS_,                                    // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(file_wcoord_,                                                // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_FILE_WCOORD_,                                 // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(window_,                                                     // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_WINDOW_,                                      // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(slide_,                                                      // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_SLIDE_,                                       // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(physical_length_,                                            // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_PHYSICAL_LENGTH_,                             // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(file_effsz_,                                                 // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_FILE_EFFSZ_,                                  // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(int_total_nsam_order_,                                       // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_INT_TOTAL_NSAM_ORDER_,                        // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_INPUT_INFO(mask_print_,                                                 // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_MASK_PRINT_,                                  // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    
    //!mstatspop_outputs
  
    SET_OUTPUT_INFO(calc_output_,                                               // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_CALC_OUTPUT_,                                 // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_OUTPUT_INFO(out_stats_So_,                                              // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_CALC_STATS_SO_OUTPUT_,                        // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_OUTPUT_INFO(out_stats_thetaSo_,                                         // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_CALC_STATS_THETA_OUTPUT_,                     // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_OUTPUT_INFO(out_stats_thetaTo_,                                         // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_CALC_STATS_THETA_NT_TAJ_OUTPUT_,              // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_OUTPUT_INFO(out_stats_thetaFL_,                                         // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_CALC_STATS_THETA_NT_FULI_OUTPUT_,             // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_OUTPUT_INFO(out_stats_thetaFW_,                                         // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_CALC_STATS_THETA_NT_FAYWU_OUTPUT_,            // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_OUTPUT_INFO(out_stats_thetaL_,                                          // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_CALC_STATS_THETA_NT_ZENG_OUTPUT_,             // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_OUTPUT_INFO(out_stats_thetaSA_,                                         // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_CALC_STATS_THETA_NT_ACHAZ_WAT_OUTPUT_,        // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_OUTPUT_INFO(out_stats_thetaTA_,                                         // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_CALC_STATS_THETA_NT_ACHAZ_TAJ_OUTPUT_,        // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_OUTPUT_INFO(out_stats_K_,                                               // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_CALC_STATS_DIVERGENCE_NT_OUTPUT_,             // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_OUTPUT_INFO(out_stats_thetaTHKY_,                                       // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_CALC_STATS_THETA_NT_TAJ_HKY_OUTPUT_,          // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_OUTPUT_INFO(out_stats_KHKY_,                                            // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_CALC_STATS_KHKY_OUTPUT_,                      // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_OUTPUT_INFO(out_stats_thetaS_,                                          // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_CALC_STATS_THETA_S_OUTPUT_,                   // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_OUTPUT_INFO(out_stats_thetaT_,                                          // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_CALC_STATS_THETA_T_OUTPUT_,                   // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_OUTPUT_INFO(out_stats_hapw_,                                            // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_CALC_STATS_HAPW_OUTPUT_,                      // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_OUTPUT_INFO(out_stats_nhpop_,                                           // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_CALC_STATS_NHPOP_OUTPUT_,                     // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_OUTPUT_INFO(out_stats_Dtaj_,                                            // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_CALC_STATS_DTAJ_OUTPUT_,                      // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_OUTPUT_INFO(out_stats_Dfl_,                                             // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_CALC_STATS_DFL_OUTPUT_,                       // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_OUTPUT_INFO(out_stats_Ffl_,                                             // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_CALC_STATS_FFL_OUTPUT_,                       // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_OUTPUT_INFO(out_stats_Hnfw_,                                            // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_CALC_STATS_NHFW_OUTPUT_,                      // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_OUTPUT_INFO(out_stats_Ez_,                                              // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_CALC_STATS_EZ_OUTPUT_,                        // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_OUTPUT_INFO(out_stats_Yach_,                                            // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_CALC_STATS_YACH_OUTPUT_,                      // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_OUTPUT_INFO(out_stats_Fs_,                                              // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_CALC_STATS_FS_OUTPUT_,                        // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_OUTPUT_INFO(out_stats_mdsd_,                                            // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_CALC_STATS_MDSD_OUTPUT_,                      // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_OUTPUT_INFO(out_stats_mdg1_,                                            // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_CALC_STATS_MDG1_OUTPUT_,                      // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_OUTPUT_INFO(out_stats_mdg2_,                                            // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_CALC_STATS_MDG2_OUTPUT_,                      // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_OUTPUT_INFO(out_stats_fst1all_,                                         // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_CALC_STATS_FST1ALL_OUTPUT_,                   // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_OUTPUT_INFO(out_stats_fsth_,                                            // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_CALC_STATS_FSTH_OUTPUT_,                      // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_OUTPUT_INFO(out_stats_fstHKY_,                                          // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_CALC_STATS_FSTHKY_OUTPUT_,                    // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_OUTPUT_INFO(out_stats_piwHKY_,                                          // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_CALC_STATS_PIWHKY_OUTPUT_,                    // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
    SET_OUTPUT_INFO(out_stats_piaHKY_,                                          // Variable
                   UNDEFINED_STRING,                                            // Group
                   CCALCMSTATSPOP_CALC_STATS_PIAHKY_OUTPUT_,                    // Short Name
                   UNDEFINED_STRING,                                            // Long Name
                   UNDEFINED_STRING,                                            // Description
                   UNDEFINED_STRING,                                            // Example
                   UNDEFINED_STRING,                                            // Use only if
                   UNDEFINED_STRING,                                            // Default value
                   UNDEFINED_VALUE,                                             // Min. Value
                   UNDEFINED_VALUE,                                             // Max. Value
                   OPTTYPE_mandatory)                                           // Required
  
  END_CALCULATION_INTERFACE_DEFINITION
}

CCalcMstatspop::~CCalcMstatspop() {
}

void CCalcMstatspop::Prepare(void) {
  DM_GET_INPUTS
    DM_INPUT(populations_initial_)
    DM_INPUT(ploidy_)
    DM_INPUT(b_include_unknown_)
    DM_INPUT(file_out_)
    DM_INPUT(b_force_outgroup_)
    DM_INPUT(b_outgroup_presence_)
    DM_INPUT(vint_perpop_nsam_)
    DM_INPUT(npops_)
    DM_INPUT(formatfile_)
    DM_INPUT(r2i_ploidies_)
    DM_INPUT(file_mas_)
    DM_INPUT(niter_)
    DM_INPUT(niterdata_)
    DM_INPUT(b_H0frq_)
    DM_INPUT(b_H1frq_)
    DM_INPUT(numPloidies_)
    DM_INPUT(ms_svratio_)
    DM_INPUT(length_)
    DM_INPUT(length_al_)
    DM_INPUT(freq_revert_)
    DM_INPUT(b_gfffiles_)
    DM_INPUT(file_GFF_)
    DM_INPUT(subset_positions_)
    DM_INPUT(code_name_)
    DM_INPUT(genetic_code_)
    DM_INPUT(file_H0f_)
    DM_INPUT(file_H1f_)
    DM_INPUT(criteria_transcript_)
    DM_INPUT(all_command_line_)
    DM_INPUT(file_in_)
    DM_INPUT(sort_nsam_)
    DM_INPUT(output_)
    DM_INPUT(seed_)
    DM_INPUT(file_wps_)
    DM_INPUT(file_wcoord_)
    DM_INPUT(window_)
    DM_INPUT(slide_)
    DM_INPUT(physical_length_)
    DM_INPUT(file_effsz_)
    DM_INPUT(int_total_nsam_order_)
    DM_INPUT(mask_print_)
  DM_GET_OUTPUTS
    DM_OUTPUT(calc_output_)
    DM_OUTPUT(out_stats_So_)
    DM_OUTPUT(out_stats_thetaSo_)
    DM_OUTPUT(out_stats_thetaTo_)
    DM_OUTPUT(out_stats_thetaFL_)
    DM_OUTPUT(out_stats_thetaFW_)
    DM_OUTPUT(out_stats_thetaL_)
    DM_OUTPUT(out_stats_thetaSA_)
    DM_OUTPUT(out_stats_thetaTA_)
    DM_OUTPUT(out_stats_K_)
    DM_OUTPUT(out_stats_thetaTHKY_)
    DM_OUTPUT(out_stats_KHKY_)
    DM_OUTPUT(out_stats_thetaS_)
    DM_OUTPUT(out_stats_thetaT_)
    DM_OUTPUT(out_stats_hapw_)
    DM_OUTPUT(out_stats_nhpop_)
    DM_OUTPUT(out_stats_Dtaj_)
    DM_OUTPUT(out_stats_Dfl_)
    DM_OUTPUT(out_stats_Ffl_)
    DM_OUTPUT(out_stats_Hnfw_)
    DM_OUTPUT(out_stats_Ez_)
    DM_OUTPUT(out_stats_Yach_)
    DM_OUTPUT(out_stats_Fs_)
    DM_OUTPUT(out_stats_mdsd_)
    DM_OUTPUT(out_stats_mdg1_)
    DM_OUTPUT(out_stats_mdg2_)
    DM_OUTPUT(out_stats_fst1all_)
    DM_OUTPUT(out_stats_fsth_)
    DM_OUTPUT(out_stats_fstHKY_)
    DM_OUTPUT(out_stats_piwHKY_)
    DM_OUTPUT(out_stats_piaHKY_)
  DM_END
   
/// ============================================================================
/// INPUT TRANSFORMATIONS
/// ============================================================================
  DM_NEW_DATA(include_unknown_)
  DM_NEW_DATA(force_outgroup_)
  DM_NEW_DATA(outgroup_presence_)
  DM_NEW_DATA(gfffiles_)
  DM_NEW_DATA(H0frq_)
  DM_NEW_DATA(H1frq_)
  
  include_unknown_->set_value(b_include_unknown_->value()?1:0);
  force_outgroup_->set_value(b_force_outgroup_->value()?1:0);
  outgroup_presence_->set_value(b_outgroup_presence_->value()?1:0);
  gfffiles_->set_value(b_gfffiles_->value()?1:0);
  H0frq_->set_value(b_H0frq_->value()?1:0);
  H1frq_->set_value(b_H1frq_->value()?1:0);
  
/// ============================================================================
/// CALCS
/// ============================================================================
  DM_NEW_CALC(calc_mstatspop_open_fasta_)
  DM_NEW_CALC(calc_mstatspop_open_ms_)
  DM_NEW_CALC(calc_optimal_tests_)
  DM_NEW_CALC(calc_r2_)
  DM_NEW_CALC(calc_r2p_)
  DM_NEW_CALC(calc_freq_stats_)
  DM_NEW_CALC(calc_mismatch_)
  DM_NEW_CALC(calc_sxsfss_)
  DM_NEW_CALC(calc_joint_freq_dist_)
  DM_NEW_CALC(calc_piwpiafst_1_)
  DM_NEW_CALC(calc_piwpiafst_2_)
  DM_NEW_CALC(calc_piwpiafst_3_)
  DM_NEW_CALC(calc_hwhafsth_1_)
  DM_NEW_CALC(calc_hwhafsth_2_)
  DM_NEW_CALC(calc_hwhafsth_3_)
  DM_NEW_CALC(calc_fs_)
  DM_NEW_CALC(calc_permute_2_)
  DM_NEW_CALC(calc_permute_3_)
  DM_NEW_CALC(calc_gff_)
  DM_NEW_CALC(calc_file_stats_)
  DM_NEW_CALC(calc_open_freq_spec_file_)
  DM_NEW_CALC(calc_mask_file_ms_)
  DM_NEW_CALC(calc_effec_nuc_TCGA_freqs_)
  DM_NEW_CALC(calc_lengthamng_and_calcs_)
  DM_NEW_CALC(calc_x_)
  DM_NEW_CALC(calc_y_)
  DM_NEW_CALC(calc_z_)
  DM_NEW_CALC(calc_array_ope_x_)
  DM_NEW_CALC(calc_mstatspop_output_)
  DM_NEW_CALC(calc_array_sum_all_)
  DM_NEW_CALC(calc_duplicate_populations_)
  DM_NEW_CALC(calc_tfasta_)
  DM_NEW_CALC(calc_effect_sizes_)
  DM_NEW_CALC(calc_coordinates_)
  DM_NEW_CALC(calc_weight_positions_)
     
/// ============================================================================
/// DATAS
/// ============================================================================
  DM_NEW_DATA(result_)
  DM_NEW_DATA(fasta_)
  DM_NEW_DATA(vint_perpop_nsam_iter_);
  DM_NEW_DATA(npops_iter_);
  DM_NEW_DATA(int_total_nsam_iter_);
  DM_NEW_DATA(dna_matrix_)
  DM_NEW_DATA(matrix_sizepos_)
  DM_NEW_DATA(matrix_segrpos_)
  DM_NEW_DATA(matrix_pol_)
  DM_NEW_DATA(matrix_pol_tcga_)
  DM_NEW_DATA(frequencies_)
  DM_NEW_DATA(positions_)
  DM_NEW_DATA(sites_)
  DM_NEW_DATA(sanc_)
  DM_NEW_DATA(matrix_perm_)
  DM_NEW_DATA(nsam2_)
  DM_NEW_DATA(psam2_)
  DM_NEW_DATA(argc_)
  DM_NEW_DATA(vector_mask_)
  DM_NEW_DATA(length_mask_)
  DM_NEW_DATA(matrix_mask_)
  DM_NEW_DATA(vector_priors_)
  DM_NEW_DATA(npriors_)
  DM_NEW_DATA(sum_sam_mask_)
  DM_NEW_DATA(length_seg_)
  DM_NEW_DATA(mhitbp_)
  DM_NEW_DATA(names2_)
  DM_NEW_DATA(n_site_)
  DM_NEW_DATA(DNA_matr2_)
  DM_NEW_DATA(n_samp_)
  DM_NEW_DATA(flaghky_)
  DM_NEW_DATA(flaghky0_)
  DM_NEW_DATA(jfd_)
  DM_NEW_DATA(nfd_)
  DM_NEW_DATA(li_)
  DM_NEW_DATA(anx_)
  DM_NEW_DATA(bnx_)
  DM_NEW_DATA(anxo_)
  DM_NEW_DATA(bnxo_)
  DM_NEW_DATA(lengthamng_)
  DM_NEW_DATA(missratio_)
  DM_NEW_DATA(nsites1_pop_)
  DM_NEW_DATA(nsites2_pop_)
  DM_NEW_DATA(nsites3_pop_)
  DM_NEW_DATA(nsites1_pop_outg_)
  DM_NEW_DATA(nsites2_pop_outg_)
  DM_NEW_DATA(nsites3_pop_outg_)
  DM_NEW_DATA(sum_sam_)
  DM_NEW_DATA(svratio_)
  DM_NEW_DATA(tcga_)
  DM_NEW_DATA(length_al_real_)
  DM_NEW_DATA(nmhits_)
  DM_NEW_DATA(matrix_sv_)
  DM_NEW_DATA(z_pos_)
  DM_NEW_DATA(mdw_reg_lengths_)
  DM_NEW_DATA(int_total_nsam_)
  DM_NEW_DATA(wV_)
  DM_NEW_DATA(Pp_)
  DM_NEW_DATA(nV_)
  DM_NEW_DATA(wgenes_)
  DM_NEW_DATA(nwindows_)
  DM_NEW_DATA(wP_)
  DM_NEW_DATA(wPV_)
  DM_NEW_DATA(wlimit_end_)
  DM_NEW_DATA(welimit_end_)
  DM_NEW_DATA(location_missing_ms_)
  DM_NEW_DATA(kind_length_)
  DM_NEW_DATA(freq_missing_ms_)
  DM_NEW_DATA(n_ccov_)
  DM_NEW_DATA(nsamuser_eff_)
  DM_NEW_DATA(beg_)
  DM_NEW_DATA(length_mask_real)
    
/// ============================================================================
/// DATAS - STATS
/// ============================================================================
  for (int i = 0; i < 2; i++) {
    DM_NEW_DATA2(stats_piw_, i)
    DM_NEW_DATA2(stats_pia_, i)
    DM_NEW_DATA2(stats_piT_, i)
    DM_NEW_DATA2(stats_piant_, i)
    DM_NEW_DATA2(stats_piTnt_, i)
    DM_NEW_DATA2(stats_fst_, i)
    DM_NEW_DATA2(stats_piwHKY_, i)
    DM_NEW_DATA2(stats_piaHKY_, i)
    DM_NEW_DATA2(stats_piTHKY_, i)
    DM_NEW_DATA2(stats_fstHKY_, i)
    DM_NEW_DATA2(stats_fst1all_, i)
    DM_NEW_DATA2(stats_Gst_, i)
    DM_NEW_DATA2(stats_hapw_, i)
    DM_NEW_DATA2(stats_hapa_, i)
    DM_NEW_DATA2(stats_hapT_, i)
    DM_NEW_DATA2(stats_fsth_, i)
    DM_NEW_DATA2(stats_fsth1all_, i)
    DM_NEW_DATA2(stats_fstALL_, i)
    DM_NEW_DATA2(stats_fsthALL_, i)
    DM_NEW_DATA2(stats_GstALL_, i)
    DM_NEW_DATA2(stats_S_, i)
    DM_NEW_DATA2(stats_So_, i)
    DM_NEW_DATA2(stats_thetaS_, i)
    DM_NEW_DATA2(stats_thetaSo_, i)
    DM_NEW_DATA2(stats_thetaT_, i)
    DM_NEW_DATA2(stats_thetaTo_, i)
    DM_NEW_DATA2(stats_thetaTHKY_, i)
    DM_NEW_DATA2(stats_thetaFL_, i)
    DM_NEW_DATA2(stats_thetaFW_, i)
    DM_NEW_DATA2(stats_thetaL_, i)
    DM_NEW_DATA2(stats_thetaSA_, i)
    DM_NEW_DATA2(stats_thetaTA_, i)
    DM_NEW_DATA2(stats_K_, i)
    DM_NEW_DATA2(stats_KHKY_, i)
    DM_NEW_DATA2(stats_Dtaj_, i)
    DM_NEW_DATA2(stats_Dfl_, i)
    DM_NEW_DATA2(stats_Ffl_, i)
    DM_NEW_DATA2(stats_Hnfw_, i)
    DM_NEW_DATA2(stats_Ez_, i)
    DM_NEW_DATA2(stats_Yach_, i)
    DM_NEW_DATA2(stats_R2_, i)
    DM_NEW_DATA2(stats_Fs_, i)
    DM_NEW_DATA2(stats_Rm_, i)
    DM_NEW_DATA2(stats_ZnA_, i)
    DM_NEW_DATA2(stats_freq_, i)
    DM_NEW_DATA2(stats_nh_, i)
    DM_NEW_DATA2(stats_nhpop_, i)
    DM_NEW_DATA2(stats_freqh_, i)
    DM_NEW_DATA2(stats_length_, i)
    DM_NEW_DATA2(stats_length2_, i)
    DM_NEW_DATA2(stats_lengthamng_, i)
    DM_NEW_DATA2(stats_total_length_, i)
    DM_NEW_DATA2(stats_total_real_length_, i)
    DM_NEW_DATA2(stats_total_svratio_, i)
    DM_NEW_DATA2(stats_total_tcga_, i)
    DM_NEW_DATA2(stats_tcga_, i)
    DM_NEW_DATA2(stats_sv_, i)
    DM_NEW_DATA2(stats_svT_, i)
    DM_NEW_DATA2(stats_nmhits_, i)
    DM_NEW_DATA2(stats_H0freq_, i)
    DM_NEW_DATA2(stats_H1freq_, i)
    DM_NEW_DATA2(stats_thetaH0_, i)
    DM_NEW_DATA2(stats_thetaH1_, i)
    DM_NEW_DATA2(stats_ToH0_ii_, i)
    DM_NEW_DATA2(stats_ToH0_00_, i)
    DM_NEW_DATA2(stats_To_ii_, i)
    DM_NEW_DATA2(stats_To_00_, i)
    DM_NEW_DATA2(stats_To_i0_, i)
    DM_NEW_DATA2(stats_To_Qc_ii_, i)
    DM_NEW_DATA2(stats_To_Qw_ii_, i)
    DM_NEW_DATA2(stats_To_Lc_ii_, i)
    DM_NEW_DATA2(stats_mdsd_, i)
    DM_NEW_DATA2(stats_mdg1_, i)
    DM_NEW_DATA2(stats_mdg2_, i)
    DM_NEW_DATA2(stats_mdw_, i)
    DM_NEW_DATA2(stats_linefreq_, i)
    DM_NEW_DATA2(stats_anx_, i)
    DM_NEW_DATA2(stats_bnx_, i)
    DM_NEW_DATA2(stats_anxo_, i)
    DM_NEW_DATA2(stats_bnxo_, i)
    DM_NEW_DATA2(stats_R2p_, i)
  }

/// ============================================================================
/// DATAS - PROBS
/// ============================================================================
  DM_NEW_DATA(piter_i_)
  DM_NEW_DATA(piter_ih_)
  DM_NEW_DATA(piter_igh_)
  DM_NEW_DATA(piter_i1_)
  DM_NEW_DATA(piter_ih1_)
  DM_NEW_DATA(piter_niteri_)
  DM_NEW_DATA(piter_niterih_)
  DM_NEW_DATA(piter_niterigh_)
  DM_NEW_DATA(piter_niteri1_)
  DM_NEW_DATA(piter_niterih1_)
  DM_NEW_DATA(piter_iall_)
  DM_NEW_DATA(piter_ihall_)
  DM_NEW_DATA(piter_ighall_)
  DM_NEW_DATA(piter_niteriall_)
  DM_NEW_DATA(piter_niterihall_)
  DM_NEW_DATA(piter_niterighall_)
}

void CCalcMstatspop::MultiplyPopulationsDependingOnPloidy(void) {
  /// ==========================================================================
  /// MULTIPLY POPULATIONS (BY 2 IF DIPLOID,...) EXCEPT THE OUTGROUP POP.
  /// ==========================================================================
  static bool prepare2 = true;
  if (prepare2) {
    prepare2 = false;
    calc_duplicate_populations_->SetInput(npops_);
    calc_duplicate_populations_->SetInput(ploidy_);
    calc_duplicate_populations_->SetInput(outgroup_presence_);
    calc_duplicate_populations_->SetInput(formatfile_);
    calc_duplicate_populations_->SetOutput(vint_perpop_nsam_);
    calc_duplicate_populations_->SetOutput(int_total_nsam_);
    calc_duplicate_populations_->Prepare();
  }
  calc_duplicate_populations_->Calculate(manager()->all_commands()->dry_run());
  calc_duplicate_populations_->Finalize();
  // ===========================================================================
}

void CCalcMstatspop::GetSumOfPopulations(void) {
  /// ==========================================================================
  /// SUM ALL ARRAY VALUES
  /// ==========================================================================
  static bool prepare2 = true;
  if (prepare2) {
    prepare2 = false;
    calc_array_sum_all_->SetInput(vint_perpop_nsam_);
    calc_array_sum_all_->SetInput(npops_);
    calc_array_sum_all_->SetOutput(int_total_nsam_);
    calc_array_sum_all_->Prepare();
  }
  calc_array_sum_all_->Calculate(manager()->all_commands()->dry_run());
  calc_array_sum_all_->Finalize();
  // ===========================================================================
}

void CCalcMstatspop::CalcMdwRegLengths(void) {
  /// ==========================================================================
  /// input:  [x][x]...[x]]
  /// output: [(x*x-1)/2][(x*x-1)/2]...[(x*x-1)/2]
  /// ==========================================================================
  static bool prepare2 = true;
  if (prepare2) {
    prepare2 = false;
    calc_array_ope_x_->SetInput(ploidy_);
    calc_array_ope_x_->SetInput(include_unknown_);
    calc_array_ope_x_->SetInput(force_outgroup_);
    calc_array_ope_x_->SetInput(outgroup_presence_);
    calc_array_ope_x_->SetInput(vint_perpop_nsam_);
    calc_array_ope_x_->SetInput(npops_);
    calc_array_ope_x_->SetInput(int_total_nsam_);
    calc_array_ope_x_->SetOutput(mdw_reg_lengths_);
    calc_array_ope_x_->Prepare();
  }
  calc_array_ope_x_->Calculate(manager()->all_commands()->dry_run());
  calc_array_ope_x_->Finalize();
  // ===========================================================================
}

void CCalcMstatspop::OpenAlternativeAndFreqSpectrumFile(void) {
  /// ==========================================================================
  /// OPEN ALTERNATIVE AND NULL FREQUENCY SPECTRUM FILE
  /// ==========================================================================
  static bool prepare2 = true;
  if (prepare2) {
    prepare2 = false;
    calc_open_freq_spec_file_->SetInput(ploidy_);
    calc_open_freq_spec_file_->SetInput(vint_perpop_nsam_);
    calc_open_freq_spec_file_->SetInput(npops_);
    calc_open_freq_spec_file_->SetInput(file_H1f_);
    calc_open_freq_spec_file_->SetInput(file_H0f_);
    calc_open_freq_spec_file_->SetOutput(stats_H1freq_[0]);
    calc_open_freq_spec_file_->SetOutput(stats_thetaH1_[0]);
    calc_open_freq_spec_file_->SetOutput(stats_H0freq_[0]);
    calc_open_freq_spec_file_->SetOutput(stats_thetaH1_[0]);
    calc_open_freq_spec_file_->SetOutput(H1frq_);
    calc_open_freq_spec_file_->SetOutput(H0frq_);
    calc_open_freq_spec_file_->Prepare();
  }
  calc_open_freq_spec_file_->Calculate(manager()->all_commands()->dry_run());
  calc_open_freq_spec_file_->Finalize();
  // ===========================================================================
}

void CCalcMstatspop::ReadFastaFile(void) {
  /// ==========================================================================
  /// READ FASTA FILE
  /// ==========================================================================
  static bool prepare2 = true;
  if (prepare2) {
    prepare2 = false;
    calc_mstatspop_open_fasta_->SetInput(file_in_);
    calc_mstatspop_open_fasta_->SetInput(ploidy_);
    calc_mstatspop_open_fasta_->SetInput(outgroup_presence_);
    calc_mstatspop_open_fasta_->SetInput(vint_perpop_nsam_);
    calc_mstatspop_open_fasta_->SetInput(npops_);
    calc_mstatspop_open_fasta_->SetInput(sort_nsam_);
    calc_mstatspop_open_fasta_->SetOutput(length_);
    calc_mstatspop_open_fasta_->SetOutput(names2_);
    calc_mstatspop_open_fasta_->SetOutput(n_site_);
    calc_mstatspop_open_fasta_->SetOutput(DNA_matr2_);
    calc_mstatspop_open_fasta_->SetOutput(n_samp_);
    calc_mstatspop_open_fasta_->SetOutput(matrix_segrpos_);
    calc_mstatspop_open_fasta_->SetOutput(matrix_sizepos_);
    calc_mstatspop_open_fasta_->SetOutput(nsamuser_eff_);
    calc_mstatspop_open_fasta_->Prepare();
  }
  calc_mstatspop_open_fasta_->Calculate(manager()->all_commands()->dry_run());
  calc_mstatspop_open_fasta_->Finalize();
  // ===========================================================================
}

bool CCalcMstatspop::ReadTFastaFile(void) {
  /// ==========================================================================
  /// READ THE T-FASTA FILE
  /// ==========================================================================
  static bool prepare = true;
  if (prepare) {
    prepare = false;
    calc_tfasta_->SetInput(file_in_);
    calc_tfasta_->SetInput(nwindows_);
    calc_tfasta_->SetInput(wgenes_);
    calc_tfasta_->SetInput(wlimit_end_);
    calc_tfasta_->SetInput(wP_);
    calc_tfasta_->SetInput(wPV_);
    calc_tfasta_->SetInput(ploidy_);
    calc_tfasta_->SetInput(npops_);
    calc_tfasta_->SetInput(outgroup_presence_);
    calc_tfasta_->SetInput(vint_perpop_nsam_);
    calc_tfasta_->SetInput(physical_length_);
    calc_tfasta_->SetInput(window_);
    calc_tfasta_->SetInput(slide_);
    calc_tfasta_->SetInput(sort_nsam_);
    calc_tfasta_->SetOutput(n_site_);
    calc_tfasta_->SetOutput(names2_);  // *
    calc_tfasta_->SetOutput(DNA_matr2_);  // *
    calc_tfasta_->SetOutput(vector_priors_);
    calc_tfasta_->SetOutput(mhitbp_);
    calc_tfasta_->SetOutput(matrix_sizepos_);
    calc_tfasta_->SetOutput(matrix_segrpos_);
    calc_tfasta_->SetOutput(n_samp_);
    calc_tfasta_->SetOutput(li_);
    calc_tfasta_->SetOutput(length_);
    calc_tfasta_->SetOutput(npriors_);
    calc_tfasta_->SetOutput(nsamuser_eff_);
    calc_tfasta_->SetOutput(beg_);
    calc_tfasta_->SetOutput(result_);
    calc_tfasta_->Prepare();
  }
  calc_tfasta_->Calculate(manager()->all_commands()->dry_run());
  if (!(result_->value()==1)) {
    calc_tfasta_->Finalize();
  }
  /// ==========================================================================
  
  return (result_->value()==1);
}

void CCalcMstatspop::ReadEffectSizesFile(void) {
  /// ==========================================================================
  /// READ THE EFFECT SIZES FILE
  /// ==========================================================================
  static bool prepare2 = true;
  if (prepare2) {
    prepare2 = false;
    calc_effect_sizes_->SetInput(file_effsz_);
    calc_effect_sizes_->SetOutput(wV_);
    calc_effect_sizes_->SetOutput(Pp_);
    calc_effect_sizes_->SetOutput(nV_);
    calc_effect_sizes_->SetOutput(welimit_end_);
    calc_effect_sizes_->Prepare();
  }
  calc_effect_sizes_->Calculate(manager()->all_commands()->dry_run());
  calc_effect_sizes_->Finalize();
  /// ==========================================================================
}
  
void CCalcMstatspop::ReadCoordinatesFile(void) {
  /// ==========================================================================
  /// READ THE COORDINATES FILE
  /// ==========================================================================
  static bool prepare2 = true;
  if (prepare2) {
    prepare2 = false;
    calc_coordinates_->SetInput(file_wcoord_);
    calc_coordinates_->SetOutput(wgenes_);
    calc_coordinates_->SetOutput(nwindows_);
    calc_coordinates_->Prepare();
  }
  calc_coordinates_->Calculate(manager()->all_commands()->dry_run());
  calc_coordinates_->Finalize();
  /// ==========================================================================
}

void CCalcMstatspop::ReadWeightPositionsFile(void) {
  /// ==========================================================================
  /// READ THE WEIGTH POSITIONS FILE
  /// ==========================================================================
  static bool prepare2 = true;
  if (prepare2) {
    prepare2 = false;
    calc_weight_positions_->SetInput(file_wps_);
    calc_weight_positions_->SetOutput(wP_);
    calc_weight_positions_->SetOutput(wPV_);
    calc_weight_positions_->SetOutput(wV_);
    calc_weight_positions_->SetOutput(wlimit_end_);
    calc_weight_positions_->Prepare();
  }
  calc_weight_positions_->Calculate(manager()->all_commands()->dry_run());
  calc_weight_positions_->Finalize();
  /// ==========================================================================
}
  
void CCalcMstatspop::FilterDnaMatrixWithGFFFile(void) {
  /// ==========================================================================
  /// FILTER THE DNA_MATRIX USING A GFF FILE
  /// ==========================================================================
  static bool prepare2 = true;
  if (prepare2) {
    prepare2 = false;
    calc_gff_->SetInput(include_unknown_);
    calc_gff_->SetInput(outgroup_presence_);
    calc_gff_->SetInput(vint_perpop_nsam_);
    calc_gff_->SetInput(npops_);
    calc_gff_->SetInput(DNA_matr2_); // It is an output Too
    calc_gff_->SetInput(file_GFF_);  // e.g.: "examples/MC1R.gff";
    calc_gff_->SetInput(subset_positions_);  // e.g.: "nonsynonymous"
    calc_gff_->SetInput(genetic_code_);
    calc_gff_->SetInput(criteria_transcript_);
    calc_gff_->SetInput(nsamuser_eff_);  // It was n_samp_
    calc_gff_->SetInput(n_site_);
    calc_gff_->SetOutput(matrix_sizepos_);
    calc_gff_->SetOutput(matrix_segrpos_);
    calc_gff_->SetOutput(mhitbp_);
    calc_gff_->SetOutput(nmhits_);
    calc_gff_->Prepare();
  }
  calc_gff_->Calculate(manager()->all_commands()->dry_run());
  calc_gff_->Finalize();
  // ===========================================================================
}
  
void CCalcMstatspop::CalculateStats(void) {
  CDataInt64 *formatfile64 = NULL;
  DM_NEW_DATA(formatfile64)

  nmhits_->set_value(0);
    
  /// ==========================================================================
  /// CALCULATE STATS
  /// ==========================================================================
  static bool prepare2 = true;
  if (prepare2) {
    prepare2 = false;
    calc_file_stats_->SetInput(ploidy_);
    calc_file_stats_->SetInput(include_unknown_);
    calc_file_stats_->SetInput(outgroup_presence_);
    calc_file_stats_->SetInput(vint_perpop_nsam_);
    calc_file_stats_->SetInput(npops_);
    calc_file_stats_->SetInput(names2_);
    calc_file_stats_->SetInput(n_site_);
    calc_file_stats_->SetInput(DNA_matr2_);
    calc_file_stats_->SetInput(matrix_segrpos_);
    calc_file_stats_->SetInput(file_in_);
    calc_file_stats_->SetInput(file_mas_);
    calc_file_stats_->SetInput(output_);
    if (formatfile_->value() == TFASTA_FILE) {
      calc_file_stats_->SetInput(beg_);
    } else {
      formatfile64->set_value(0);
      calc_file_stats_->SetInput(formatfile64);
    }
    calc_file_stats_->SetOutput(matrix_pol_);
    calc_file_stats_->SetOutput(matrix_pol_tcga_);
    calc_file_stats_->SetOutput(lengthamng_);
    calc_file_stats_->SetOutput(tcga_);
    calc_file_stats_->SetOutput(anx_);
    calc_file_stats_->SetOutput(bnx_);
    calc_file_stats_->SetOutput(anxo_);
    calc_file_stats_->SetOutput(bnxo_);
    calc_file_stats_->SetOutput(length_al_);
    calc_file_stats_->SetOutput(length_seg_);
    calc_file_stats_->SetOutput(missratio_);
    calc_file_stats_->SetOutput(nsites1_pop_);
    calc_file_stats_->SetOutput(nsites1_pop_outg_);
    calc_file_stats_->SetOutput(nsites2_pop_);
    calc_file_stats_->SetOutput(nsites2_pop_outg_);
    calc_file_stats_->SetOutput(nsites3_pop_);
    calc_file_stats_->SetOutput(nsites3_pop_outg_);
    calc_file_stats_->SetOutput(sum_sam_);
    calc_file_stats_->SetOutput(svratio_);
    calc_file_stats_->SetOutput(frequencies_);
    calc_file_stats_->SetOutput(positions_);
    calc_file_stats_->SetOutput(matrix_sv_);
    calc_file_stats_->SetOutput(mhitbp_);
    calc_file_stats_->SetOutput(length_al_real_);
    calc_file_stats_->SetOutput(nmhits_);
    calc_file_stats_->SetOutput(matrix_sizepos_);
    calc_file_stats_->SetOutput(nsamuser_eff_);
    calc_file_stats_->Prepare();
  }
  calc_file_stats_->Calculate(manager()->all_commands()->dry_run());
  calc_file_stats_->Finalize();
  // ===========================================================================
  
  DM_DEL_DATA(formatfile64)
}


void CCalcMstatspop::MsMaskFile(void) {
  /// ==========================================================================
  /// MS MASK FILE
  /// ==========================================================================
  static bool prepare2 = true;
  if (prepare2) {
    prepare2 = false;
    calc_mask_file_ms_->SetInput(include_unknown_);
    calc_mask_file_ms_->SetInput(outgroup_presence_);
    calc_mask_file_ms_->SetInput(vint_perpop_nsam_);
    calc_mask_file_ms_->SetInput(npops_);
    calc_mask_file_ms_->SetInput(int_total_nsam_);
    calc_mask_file_ms_->SetInput(file_mas_);
    calc_mask_file_ms_->SetInput(length_);
    calc_mask_file_ms_->SetOutput(niter_);
    calc_mask_file_ms_->SetOutput(length_al_real_);
    calc_mask_file_ms_->SetOutput(vector_mask_);
    calc_mask_file_ms_->SetOutput(matrix_mask_);
    calc_mask_file_ms_->SetOutput(sum_sam_mask_);
    calc_mask_file_ms_->SetOutput(length_mask_);
    calc_mask_file_ms_->SetOutput(missratio_);
    calc_mask_file_ms_->SetOutput(length_al_);
    calc_mask_file_ms_->Prepare();
  }
  calc_mask_file_ms_->Calculate(manager()->all_commands()->dry_run());
  calc_mask_file_ms_->Finalize();
  // ===========================================================================
}

void CCalcMstatspop::OpenMsFile(void) {
  /// ==========================================================================
  /// READ MS FILE
  /// ==========================================================================
  if (li_->value() == 0) {
    // Execute this only the first time:

    calc_mstatspop_open_ms_->SetInput(file_in_);
    calc_mstatspop_open_ms_->SetInput(include_unknown_);
    calc_mstatspop_open_ms_->SetInput(outgroup_presence_);
    calc_mstatspop_open_ms_->SetInput(force_outgroup_);
    calc_mstatspop_open_ms_->SetInput(vint_perpop_nsam_);
    calc_mstatspop_open_ms_->SetInput(npops_);
    calc_mstatspop_open_ms_->SetInput(int_total_nsam_);
    calc_mstatspop_open_ms_->SetInput(length_);
    calc_mstatspop_open_ms_->SetInput(kind_length_);
    calc_mstatspop_open_ms_->SetInput(vector_mask_);
    calc_mstatspop_open_ms_->SetInput(ms_svratio_);
    calc_mstatspop_open_ms_->SetInput(freq_revert_);
    calc_mstatspop_open_ms_->SetInput(file_mas_);
    calc_mstatspop_open_ms_->SetInput(freq_missing_ms_);
    calc_mstatspop_open_ms_->SetInput(location_missing_ms_);
    calc_mstatspop_open_ms_->SetInput(formatfile_);
    calc_mstatspop_open_ms_->SetInput(length_mask_real);
    calc_mstatspop_open_ms_->SetInput(mask_print_);
    calc_mstatspop_open_ms_->SetOutput(matrix_pol_);
    calc_mstatspop_open_ms_->SetOutput(frequencies_);
    calc_mstatspop_open_ms_->SetOutput(positions_);
    calc_mstatspop_open_ms_->SetOutput(length_seg_);
    calc_mstatspop_open_ms_->SetOutput(matrix_sv_);
    calc_mstatspop_open_ms_->SetOutput(length_mask_);
    calc_mstatspop_open_ms_->SetOutput(lengthamng_);
    calc_mstatspop_open_ms_->SetOutput(nmhits_);
    calc_mstatspop_open_ms_->SetOutput(matrix_mask_);
    calc_mstatspop_open_ms_->SetOutput(vector_priors_);
    calc_mstatspop_open_ms_->SetOutput(npriors_);
    calc_mstatspop_open_ms_->SetOutput(sum_sam_);
    calc_mstatspop_open_ms_->SetOutput(sum_sam_mask_);
    calc_mstatspop_open_ms_->SetOutput(nsites1_pop_);
    calc_mstatspop_open_ms_->SetOutput(nsites1_pop_outg_);
    calc_mstatspop_open_ms_->SetOutput(nsites2_pop_);
    calc_mstatspop_open_ms_->SetOutput(nsites2_pop_outg_);
    calc_mstatspop_open_ms_->SetOutput(nsites3_pop_);
    calc_mstatspop_open_ms_->SetOutput(nsites3_pop_outg_);
    calc_mstatspop_open_ms_->SetOutput(anx_);
    calc_mstatspop_open_ms_->SetOutput(bnx_);
    calc_mstatspop_open_ms_->SetOutput(anxo_);
    calc_mstatspop_open_ms_->SetOutput(bnxo_);
    calc_mstatspop_open_ms_->SetOutput(missratio_);
    calc_mstatspop_open_ms_->SetOutput(sort_nsam_);
    
    calc_mstatspop_open_ms_->Prepare();
  }
  calc_mstatspop_open_ms_->Calculate(manager()->all_commands()->dry_run());
  // ===========================================================================
}

void CCalcMstatspop::CalcX(void) {
  /// ==========================================================================
  /// CALC X
  /// ==========================================================================
  static bool prepare = true;
  if (prepare) {
    prepare = false;
    calc_x_->SetInput(include_unknown_);
    calc_x_->SetInput(vint_perpop_nsam_);
    calc_x_->SetInput(npops_);
    calc_x_->SetInput(int_total_nsam_);
    calc_x_->SetInput(vector_mask_);
    calc_x_->SetInput(length_);
    calc_x_->SetInput(length_mask_);
    calc_x_->SetInput(sum_sam_mask_);
    calc_x_->SetInput(nmhits_);
    calc_x_->SetInput(file_mas_);
    calc_x_->SetOutput(length_al_);
    calc_x_->SetOutput(flaghky_);
    calc_x_->SetOutput(sum_sam_);
    calc_x_->SetOutput(stats_length_[0]);
    calc_x_->SetOutput(stats_linefreq_[0]);
    calc_x_->SetOutput(stats_total_tcga_[0]);
    calc_x_->SetOutput(stats_tcga_[0]);
    calc_x_->Prepare();
  }
  calc_x_->Calculate(manager()->all_commands()->dry_run());
  calc_x_->Finalize();
  // ===========================================================================
}

void CCalcMstatspop::CalEffectiveNucleotidesAndTCGAFreqs(void) {
  /// ==========================================================================
  /// CALCULATE  NUMBER OF EFFECTIVE NUCLEOTIDES PER POPULATION AND TCGA FREQS
  /// ==========================================================================
  static bool prepare2 = true;
  if (prepare2) {
    prepare2 = false;
    calc_effec_nuc_TCGA_freqs_->SetInput(vint_perpop_nsam_);
    calc_effec_nuc_TCGA_freqs_->SetInput(npops_);
    calc_effec_nuc_TCGA_freqs_->SetInput(nsites2_pop_);
    calc_effec_nuc_TCGA_freqs_->SetInput(sum_sam_);
    calc_effec_nuc_TCGA_freqs_->SetInput(anx_);
    calc_effec_nuc_TCGA_freqs_->SetInput(bnx_);
    calc_effec_nuc_TCGA_freqs_->SetInput(anxo_);
    calc_effec_nuc_TCGA_freqs_->SetInput(bnxo_);
    calc_effec_nuc_TCGA_freqs_->SetInput(tcga_);
    calc_effec_nuc_TCGA_freqs_->SetOutput(stats_length_[0]);
    calc_effec_nuc_TCGA_freqs_->SetOutput(stats_length2_[0]);
    calc_effec_nuc_TCGA_freqs_->SetOutput(stats_anx_[0]);
    calc_effec_nuc_TCGA_freqs_->SetOutput(stats_bnx_[0]);
    calc_effec_nuc_TCGA_freqs_->SetOutput(stats_anxo_[0]);
    calc_effec_nuc_TCGA_freqs_->SetOutput(stats_bnxo_[0]);
    calc_effec_nuc_TCGA_freqs_->SetOutput(stats_tcga_[0]);
    calc_effec_nuc_TCGA_freqs_->SetOutput(stats_total_tcga_[0]);
    calc_effec_nuc_TCGA_freqs_->Prepare();
  }
  calc_effec_nuc_TCGA_freqs_->Calculate(manager()->all_commands()->dry_run());
  calc_effec_nuc_TCGA_freqs_->Finalize();
  // ===========================================================================
}

void CCalcMstatspop::IncludeLengthMngAndCalculations(void) {
  /// ==========================================================================
  /// INCLUDE LENGTHMNG AND CALCULATIONS
  /// ==========================================================================
  static bool prepare2 = true;
  if (prepare2) {
    prepare2 = false;
    calc_lengthamng_and_calcs_->SetInput(outgroup_presence_);
    calc_lengthamng_and_calcs_->SetInput(npops_);
    calc_lengthamng_and_calcs_->SetInput(length_seg_);
    calc_lengthamng_and_calcs_->SetInput(lengthamng_);
    calc_lengthamng_and_calcs_->SetInput(length_al_);
    calc_lengthamng_and_calcs_->SetInput(length_al_real_);
    calc_lengthamng_and_calcs_->SetInput(svratio_);
    calc_lengthamng_and_calcs_->SetInput(nmhits_);
    calc_lengthamng_and_calcs_->SetInput(vint_perpop_nsam_);
    calc_lengthamng_and_calcs_->SetInput(int_total_nsam_);
    calc_lengthamng_and_calcs_->SetOutput(stats_lengthamng_[0]);
    calc_lengthamng_and_calcs_->SetOutput(stats_total_length_[0]);
    calc_lengthamng_and_calcs_->SetOutput(stats_total_real_length_[0]);
    calc_lengthamng_and_calcs_->SetOutput(stats_total_svratio_[0]);
    calc_lengthamng_and_calcs_->SetOutput(stats_nmhits_[0]);
    calc_lengthamng_and_calcs_->SetOutput(jfd_);
    calc_lengthamng_and_calcs_->SetOutput(nfd_);
    calc_lengthamng_and_calcs_->SetOutput(stats_linefreq_[0]);
    calc_lengthamng_and_calcs_->SetOutput(stats_freq_[0]);
    calc_lengthamng_and_calcs_->SetOutput(stats_mdsd_[0]); 
    calc_lengthamng_and_calcs_->Prepare();
  }
  calc_lengthamng_and_calcs_->Calculate(manager()->all_commands()->dry_run());
  calc_lengthamng_and_calcs_->Finalize();
  // ===========================================================================
}

void CCalcMstatspop::CalcSxsfss(void) {
  /// ==========================================================================
  /// GET THE SITES MATRIX FROM THE MATRIX POL
  /// ==========================================================================
  static bool prepare2 = true;
  if (prepare2) {
    prepare2 = false;
    calc_sxsfss_->SetInput(force_outgroup_);
    calc_sxsfss_->SetInput(outgroup_presence_);
    calc_sxsfss_->SetInput(vint_perpop_nsam_);
    calc_sxsfss_->SetInput(npops_);
    calc_sxsfss_->SetInput(matrix_pol_);
    calc_sxsfss_->SetInput(positions_);
    calc_sxsfss_->SetInput(length_seg_);
    calc_sxsfss_->SetOutput(sites_);
    calc_sxsfss_->SetOutput(sanc_);
    calc_sxsfss_->Prepare();
  }
  calc_sxsfss_->Calculate(manager()->all_commands()->dry_run());
  calc_sxsfss_->Finalize();
  // ===========================================================================
}

void CCalcMstatspop::CalcJointFreqDistribution(void) {
  /// ==========================================================================
  /// JOINT FREQUENCY DISTRIBUTION
  /// ==========================================================================
  static bool prepare2 = true;
  if (prepare2) {
    prepare2 = false;
    calc_joint_freq_dist_->SetInput(force_outgroup_);
    calc_joint_freq_dist_->SetInput(outgroup_presence_);
    calc_joint_freq_dist_->SetInput(vint_perpop_nsam_);
    calc_joint_freq_dist_->SetInput(npops_);
    calc_joint_freq_dist_->SetInput(matrix_pol_);
    calc_joint_freq_dist_->SetInput(length_seg_);
    calc_joint_freq_dist_->SetOutput(jfd_);
    calc_joint_freq_dist_->SetOutput(stats_linefreq_[0]);
    calc_joint_freq_dist_->SetOutput(nfd_);
    calc_joint_freq_dist_->Prepare();
  }
  calc_joint_freq_dist_->Calculate(manager()->all_commands()->dry_run());
  calc_joint_freq_dist_->Finalize();
  // ===========================================================================
}

void CCalcMstatspop::CalcPiwpiafst_1(void) {
  /// ==========================================================================
  /// PIWPIAFST
  /// ==========================================================================
  static bool prepare = true;
  if (prepare) {
    prepare = false;
    calc_piwpiafst_1_->SetInput(vint_perpop_nsam_);
    calc_piwpiafst_1_->SetInput(npops_);
    calc_piwpiafst_1_->SetInput(matrix_pol_);
    calc_piwpiafst_1_->SetInput(matrix_sv_);
    calc_piwpiafst_1_->SetInput(stats_tcga_[0]);
    calc_piwpiafst_1_->SetInput(stats_lengthamng_[0]);
    calc_piwpiafst_1_->SetInput(flaghky_);
    calc_piwpiafst_1_->SetInput(stats_length2_[0]);
    calc_piwpiafst_1_->SetInput(formatfile_);
    calc_piwpiafst_1_->SetInput(length_seg_);
    calc_piwpiafst_1_->SetOutput(stats_sv_[0]);
    calc_piwpiafst_1_->SetOutput(stats_svT_[0]);
    calc_piwpiafst_1_->SetOutput(stats_fst_[0]);
    calc_piwpiafst_1_->SetOutput(stats_fst1all_[0]);
    calc_piwpiafst_1_->SetOutput(stats_fstHKY_[0]);
    calc_piwpiafst_1_->SetOutput(stats_K_[0]);
    calc_piwpiafst_1_->SetOutput(stats_KHKY_[0]);
    calc_piwpiafst_1_->SetOutput(stats_pia_[0]);
    calc_piwpiafst_1_->SetOutput(stats_piaHKY_[0]);
    calc_piwpiafst_1_->SetOutput(stats_piT_[0]);
    calc_piwpiafst_1_->SetOutput(stats_piTHKY_[0]);
    calc_piwpiafst_1_->SetOutput(stats_piwHKY_[0]);
    calc_piwpiafst_1_->SetOutput(stats_piw_[0]);
    calc_piwpiafst_1_->SetOutput(stats_thetaTHKY_[0]);
    calc_piwpiafst_1_->SetOutput(stats_piant_[0]);
    calc_piwpiafst_1_->SetOutput(stats_piTnt_[0]);
    calc_piwpiafst_1_->SetOutput(stats_fstALL_[0]);
    calc_piwpiafst_1_->Prepare();
  }
  calc_piwpiafst_1_->Calculate(manager()->all_commands()->dry_run());
  calc_piwpiafst_1_->Finalize();
  // ===========================================================================
}

void CCalcMstatspop::CalcPiwpiafst_2(void) {
  /// ==========================================================================
  /// PIWPIAFST
  /// ==========================================================================
  static bool prepare = true;
  if (prepare) {
    prepare = false;
    calc_piwpiafst_2_->SetInput(vint_perpop_nsam_);
    calc_piwpiafst_2_->SetInput(npops_);
    calc_piwpiafst_2_->SetInput(matrix_perm_);  // <--- matrix_pol
    calc_piwpiafst_2_->SetInput(matrix_sv_);
    calc_piwpiafst_2_->SetInput(stats_tcga_[1]);
    calc_piwpiafst_2_->SetInput(stats_lengthamng_[1]);
    calc_piwpiafst_2_->SetInput(flaghky0_);  // <--- 0
    calc_piwpiafst_2_->SetInput(stats_length2_[1]);
    calc_piwpiafst_2_->SetInput(formatfile_);
    calc_piwpiafst_2_->SetInput(length_seg_);
    calc_piwpiafst_2_->SetOutput(stats_sv_[1]);
    calc_piwpiafst_2_->SetOutput(stats_svT_[1]);
    calc_piwpiafst_2_->SetOutput(stats_fst_[1]);
    calc_piwpiafst_2_->SetOutput(stats_fst1all_[1]);
    calc_piwpiafst_2_->SetOutput(stats_fstHKY_[1]);
    calc_piwpiafst_2_->SetOutput(stats_K_[1]);
    calc_piwpiafst_2_->SetOutput(stats_KHKY_[1]);
    calc_piwpiafst_2_->SetOutput(stats_pia_[1]);
    calc_piwpiafst_2_->SetOutput(stats_piaHKY_[1]);
    calc_piwpiafst_2_->SetOutput(stats_piT_[1]);
    calc_piwpiafst_2_->SetOutput(stats_piTHKY_[1]);
    calc_piwpiafst_2_->SetOutput(stats_piwHKY_[1]);
    calc_piwpiafst_2_->SetOutput(stats_piw_[1]);
    calc_piwpiafst_2_->SetOutput(stats_thetaTHKY_[1]);
    calc_piwpiafst_2_->SetOutput(stats_piant_[1]);
    calc_piwpiafst_2_->SetOutput(stats_piTnt_[1]);
    calc_piwpiafst_2_->SetOutput(stats_fstALL_[1]);
    calc_piwpiafst_2_->Prepare();
  }
  flaghky0_->set_value(0);
  calc_piwpiafst_2_->Calculate(manager()->all_commands()->dry_run());
  calc_piwpiafst_2_->Finalize();
  // ===========================================================================
}

void CCalcMstatspop::CalcPiwpiafst_3(void) {
  /// ==========================================================================
  /// PIWPIAFST
  /// ==========================================================================
    static bool prepare = true;
  if (prepare) {
    prepare = false;
    calc_piwpiafst_3_->SetInput(nsam2_);  //  <--- nsam2                            // NO: vint_perpop_nsam_iter_
    calc_piwpiafst_3_->SetInput(npops_iter_);             //  <--- 2
    calc_piwpiafst_3_->SetInput(matrix_perm_);            //  <--- matrix_pol
    calc_piwpiafst_3_->SetInput(matrix_sv_);
    calc_piwpiafst_3_->SetInput(stats_tcga_[1]);
    calc_piwpiafst_3_->SetInput(stats_lengthamng_[1]);
    calc_piwpiafst_3_->SetInput(flaghky0_);                //  <--- 0
    calc_piwpiafst_3_->SetInput(stats_length2_[1]);
    calc_piwpiafst_3_->SetInput(formatfile_);
    calc_piwpiafst_3_->SetInput(length_seg_);
    calc_piwpiafst_3_->SetOutput(stats_sv_[1]);
    calc_piwpiafst_3_->SetOutput(stats_svT_[1]);
    calc_piwpiafst_3_->SetOutput(stats_fst_[1]);
    calc_piwpiafst_3_->SetOutput(stats_fst1all_[1]);
    calc_piwpiafst_3_->SetOutput(stats_fstHKY_[1]);
    calc_piwpiafst_3_->SetOutput(stats_K_[1]);
    calc_piwpiafst_3_->SetOutput(stats_KHKY_[1]);
    calc_piwpiafst_3_->SetOutput(stats_pia_[1]);
    calc_piwpiafst_3_->SetOutput(stats_piaHKY_[1]);
    calc_piwpiafst_3_->SetOutput(stats_piT_[1]);
    calc_piwpiafst_3_->SetOutput(stats_piTHKY_[1]);
    calc_piwpiafst_3_->SetOutput(stats_piwHKY_[1]);
    calc_piwpiafst_3_->SetOutput(stats_piw_[1]);
    calc_piwpiafst_3_->SetOutput(stats_thetaTHKY_[1]);
    calc_piwpiafst_3_->SetOutput(stats_piant_[1]);
    calc_piwpiafst_3_->SetOutput(stats_piTnt_[1]);
    calc_piwpiafst_3_->SetOutput(stats_fstALL_[1]);
    calc_piwpiafst_3_->Prepare();
  }
  npops_iter_->set_value(2);
  flaghky0_->set_value(0);
  calc_piwpiafst_3_->Calculate(manager()->all_commands()->dry_run());
  calc_piwpiafst_3_->Finalize();
  // ===========================================================================
}

void CCalcMstatspop::CalcFrequencyStats(void) {
  /// ==========================================================================
  /// FREQUENCY STATISTICS
  /// ==========================================================================
  static bool prepare2 = true;
  if (prepare2) {
    prepare2 = false;
    calc_freq_stats_->SetInput(include_unknown_);
    calc_freq_stats_->SetInput(force_outgroup_);
    calc_freq_stats_->SetInput(outgroup_presence_);
    calc_freq_stats_->SetInput(vint_perpop_nsam_);
    calc_freq_stats_->SetInput(npops_);
    calc_freq_stats_->SetInput(matrix_pol_);
    calc_freq_stats_->SetInput(n_ccov_);
    calc_freq_stats_->SetInput(H1frq_);
    calc_freq_stats_->SetInput(stats_H1freq_[0]);
    calc_freq_stats_->SetInput(length_seg_);
    calc_freq_stats_->SetOutput(stats_Dfl_[0]);
    calc_freq_stats_->SetOutput(stats_Dtaj_[0]);
    calc_freq_stats_->SetOutput(stats_Ez_[0]);
    calc_freq_stats_->SetOutput(stats_Ffl_[0]);
    calc_freq_stats_->SetOutput(stats_Hnfw_[0]);
    calc_freq_stats_->SetOutput(stats_S_[0]);
    calc_freq_stats_->SetOutput(stats_So_[0]);
    calc_freq_stats_->SetOutput(stats_thetaFL_[0]);
    calc_freq_stats_->SetOutput(stats_thetaFW_[0]);
    calc_freq_stats_->SetOutput(stats_thetaL_[0]);
    calc_freq_stats_->SetOutput(stats_thetaS_[0]);
    calc_freq_stats_->SetOutput(stats_thetaSA_[0]);
    calc_freq_stats_->SetOutput(stats_thetaSo_[0]);
    calc_freq_stats_->SetOutput(stats_thetaT_[0]);
    calc_freq_stats_->SetOutput(stats_thetaTA_[0]);
    calc_freq_stats_->SetOutput(stats_thetaTo_[0]);
    calc_freq_stats_->SetOutput(stats_To_00_[0]);
    calc_freq_stats_->SetOutput(stats_To_i0_[0]);
    calc_freq_stats_->SetOutput(stats_To_ii_[0]);
    calc_freq_stats_->SetOutput(stats_ToH0_00_[0]);
    calc_freq_stats_->SetOutput(stats_ToH0_ii_[0]);
    calc_freq_stats_->SetOutput(stats_Yach_[0]);
    calc_freq_stats_->SetOutput(stats_freq_[0]);
    calc_freq_stats_->Prepare();
  }
  calc_freq_stats_->Calculate(manager()->all_commands()->dry_run());
  calc_freq_stats_->Finalize();
  // ===========================================================================
}

void CCalcMstatspop::CalcOptimalTests(void) {
  /// ==========================================================================
  /// OPTIMAL TESTS
  /// ==========================================================================
  static bool prepare2 = true;
  if (prepare2) {
    prepare2 = false;
    calc_optimal_tests_->SetInput(vint_perpop_nsam_);
    calc_optimal_tests_->SetInput(npops_);
    calc_optimal_tests_->SetInput(stats_freq_[0]);
    calc_optimal_tests_->SetInput(stats_total_length_[0]);
    calc_optimal_tests_->SetInput(stats_H1freq_[0]);
    calc_optimal_tests_->SetInput(stats_thetaH1_[0]);
    calc_optimal_tests_->SetInput(stats_H0freq_[0]);
    calc_optimal_tests_->SetInput(stats_thetaH0_[0]);
    calc_optimal_tests_->SetOutput(stats_ToH0_ii_[0]);
    calc_optimal_tests_->SetOutput(stats_To_ii_[0]);
    calc_optimal_tests_->SetOutput(stats_To_00_[0]);
    calc_optimal_tests_->SetOutput(stats_To_i0_[0]);
    calc_optimal_tests_->SetOutput(stats_ToH0_00_[0]);
    calc_optimal_tests_->SetOutput(stats_To_Qc_ii_[0]);
    calc_optimal_tests_->SetOutput(stats_To_Qw_ii_[0]);
    calc_optimal_tests_->SetOutput(stats_To_Lc_ii_[0]);
    calc_optimal_tests_->Prepare();
  }
  calc_optimal_tests_->Calculate(manager()->all_commands()->dry_run());
  calc_optimal_tests_->Finalize();
  // ===========================================================================
}

void CCalcMstatspop::CalcR2(void) {
  /// ==========================================================================
  /// R2
  /// ==========================================================================
  static bool prepare2 = true;
  if (prepare2) {
    prepare2 = false;
    calc_r2_->SetInput(ploidy_);
    calc_r2_->SetInput(vint_perpop_nsam_);
    calc_r2_->SetInput(npops_);
    calc_r2_->SetInput(matrix_pol_);
    calc_r2_->SetInput(stats_S_[0]);
    calc_r2_->SetInput(stats_thetaT_[0]);
    calc_r2_->SetInput(length_seg_);
    calc_r2_->SetOutput(stats_R2_[0]);
    calc_r2_->Prepare();
  }
  calc_r2_->Calculate(manager()->all_commands()->dry_run());
  calc_r2_->Finalize();
  // ===========================================================================
}

void CCalcMstatspop::CalcR2p(void) {
  /// ==========================================================================
  /// R2P
  /// ==========================================================================
  static bool prepare2 = true;
  if (prepare2) {
    prepare2 = false;
    calc_r2p_->SetInput(ploidy_);
    calc_r2p_->SetInput(vint_perpop_nsam_);
    calc_r2p_->SetInput(npops_);
    calc_r2p_->SetInput(matrix_pol_);
    calc_r2p_->SetInput(sum_sam_);
    calc_r2p_->SetInput(stats_S_[0]);
    calc_r2p_->SetInput(stats_thetaT_[0]);
    calc_r2p_->SetInput(r2i_ploidies_);
    calc_r2p_->SetInput(length_seg_);
    calc_r2p_->SetOutput(stats_R2_[0]);
    calc_r2p_->SetOutput(stats_R2p_[0]);
    calc_r2p_->Prepare();
  }
  calc_r2p_->Calculate(manager()->all_commands()->dry_run());
  calc_r2p_->Finalize();
  // ===========================================================================
}

void CCalcMstatspop::CalcMismatch(void) {
  /// ==========================================================================
  /// MISMATCH
  /// ==========================================================================
  static bool prepare2 = true;
  if (prepare2) {
    prepare2 = false;
    calc_mismatch_->SetInput(ploidy_);
    calc_mismatch_->SetInput(vint_perpop_nsam_);
    calc_mismatch_->SetInput(npops_);
    calc_mismatch_->SetInput(matrix_pol_);
    calc_mismatch_->SetInput(stats_thetaT_[0]);
    calc_mismatch_->SetInput(length_seg_);
    calc_mismatch_->SetOutput(stats_mdg1_[0]);
    calc_mismatch_->SetOutput(stats_mdg2_[0]);
    calc_mismatch_->SetOutput(stats_mdsd_[0]);
    calc_mismatch_->SetOutput(stats_mdw_[0]);
    calc_mismatch_->Prepare();
  }
  calc_mismatch_->Calculate(manager()->all_commands()->dry_run());
  calc_mismatch_->Finalize();
  // ===========================================================================
}

void CCalcMstatspop::CalcHwhafsth_1(void) {
  /// ==========================================================================
  /// HWHAFSTH
  /// ==========================================================================
  static bool prepare = true;
  if (prepare) {
    prepare = false;
    calc_hwhafsth_1_->SetInput(vint_perpop_nsam_);
    calc_hwhafsth_1_->SetInput(npops_);
    calc_hwhafsth_1_->SetInput(matrix_pol_);
    calc_hwhafsth_1_->SetInput(length_seg_);
    calc_hwhafsth_1_->SetOutput(stats_nhpop_[0]);
    calc_hwhafsth_1_->SetOutput(stats_hapw_[0]);
    calc_hwhafsth_1_->SetOutput(stats_hapa_[0]);
    calc_hwhafsth_1_->SetOutput(stats_hapT_[0]);
    calc_hwhafsth_1_->SetOutput(stats_fsth_[0]);
    calc_hwhafsth_1_->SetOutput(stats_fsth1all_[0]);
    calc_hwhafsth_1_->SetOutput(stats_freqh_[0]);
    calc_hwhafsth_1_->SetOutput(stats_nh_[0]);
    calc_hwhafsth_1_->SetOutput(stats_Gst_[0]);
    calc_hwhafsth_1_->SetOutput(stats_fsthALL_[0]);
    calc_hwhafsth_1_->SetOutput(stats_GstALL_[0]);
    calc_hwhafsth_1_->Prepare();
  }
  calc_hwhafsth_1_->Calculate(manager()->all_commands()->dry_run());
  calc_hwhafsth_1_->Finalize();
  // ===========================================================================
}

void CCalcMstatspop::CalcHwhafsth_2(void) {
  /// ==========================================================================
  /// HWHAFSTH
  /// ==========================================================================
  static bool prepare = true;
  if (prepare) {
    prepare = false;
    calc_hwhafsth_2_->SetInput(vint_perpop_nsam_);
    calc_hwhafsth_2_->SetInput(npops_);
    calc_hwhafsth_2_->SetInput(matrix_perm_);  // <-- matrix_pol
    calc_hwhafsth_2_->SetInput(length_seg_);
    calc_hwhafsth_2_->SetOutput(stats_nhpop_[1]);
    calc_hwhafsth_2_->SetOutput(stats_hapw_[1]);
    calc_hwhafsth_2_->SetOutput(stats_hapa_[1]);
    calc_hwhafsth_2_->SetOutput(stats_hapT_[1]);
    calc_hwhafsth_2_->SetOutput(stats_fsth_[1]);
    calc_hwhafsth_2_->SetOutput(stats_fsth1all_[1]);
    calc_hwhafsth_2_->SetOutput(stats_freqh_[1]);
    calc_hwhafsth_2_->SetOutput(stats_nh_[1]);
    calc_hwhafsth_2_->SetOutput(stats_Gst_[1]);
    calc_hwhafsth_2_->SetOutput(stats_fsthALL_[1]);
    calc_hwhafsth_2_->SetOutput(stats_GstALL_[1]);
    calc_hwhafsth_2_->Prepare();
  }
  calc_hwhafsth_2_->Calculate(manager()->all_commands()->dry_run());
  calc_hwhafsth_2_->Finalize();
  // ===========================================================================
}

void CCalcMstatspop::CalcHwhafsth_3(void) {
  /// ==========================================================================
  /// HWHAFSTH
  /// ==========================================================================
  static bool prepare = true;
  if (prepare) {
    prepare = false;
    calc_hwhafsth_3_->SetInput(nsam2_);                                             // NO: vint_perpop_nsam_iter_
    calc_hwhafsth_3_->SetInput(npops_iter_);              // <-- 2
    calc_hwhafsth_3_->SetInput(matrix_perm_);             // <-- matrix_pol
    calc_hwhafsth_3_->SetInput(length_seg_);
    calc_hwhafsth_3_->SetOutput(stats_nhpop_[1]);
    calc_hwhafsth_3_->SetOutput(stats_hapw_[1]);
    calc_hwhafsth_3_->SetOutput(stats_hapa_[1]);
    calc_hwhafsth_3_->SetOutput(stats_hapT_[1]);
    calc_hwhafsth_3_->SetOutput(stats_fsth_[1]);
    calc_hwhafsth_3_->SetOutput(stats_fsth1all_[1]);
    calc_hwhafsth_3_->SetOutput(stats_freqh_[1]);
    calc_hwhafsth_3_->SetOutput(stats_nh_[1]);
    calc_hwhafsth_3_->SetOutput(stats_Gst_[1]);
    calc_hwhafsth_3_->SetOutput(stats_fsthALL_[1]);
    calc_hwhafsth_3_->SetOutput(stats_GstALL_[1]);
    calc_hwhafsth_3_->Prepare();
  }
  npops_iter_->set_value(2);
  calc_hwhafsth_3_->Calculate(manager()->all_commands()->dry_run());
  calc_hwhafsth_3_->Finalize();
  // ===========================================================================
}

void CCalcMstatspop::CalcFs(void) {
  /// ==========================================================================
  /// FS
  /// ==========================================================================
  static bool prepare2 = true;
  if (prepare2) {
    prepare2 = false;
    calc_fs_->SetInput(vint_perpop_nsam_);
    calc_fs_->SetInput(npops_);
    calc_fs_->SetInput(stats_thetaT_[0]);
    calc_fs_->SetInput(stats_nhpop_[0]);
    calc_fs_->SetOutput(stats_Fs_[0]);
    calc_fs_->Prepare();
  }
  calc_fs_->Calculate(manager()->all_commands()->dry_run());
  calc_fs_->Finalize();
  // ===========================================================================
}

void CCalcMstatspop::CalcY(void) {
  /// ==========================================================================
  /// CALC Y
  /// ==========================================================================
  static bool prepare = true;
  if (prepare) {
    prepare = false;
    calc_y_->SetInput(ploidy_);
    calc_y_->SetInput(npops_);
    calc_y_->SetInput(stats_fst1all_[0]);
    calc_y_->SetInput(stats_fst1all_[1]);
    calc_y_->SetInput(stats_fsth1all_[0]);
    calc_y_->SetInput(stats_fsth1all_[1]);
    calc_y_->SetInput(stats_fstALL_[0]);
    calc_y_->SetInput(stats_fstALL_[1]);
    calc_y_->SetInput(stats_fsthALL_[0]);
    calc_y_->SetInput(stats_fsthALL_[1]);
    calc_y_->SetInput(stats_GstALL_[0]);
    calc_y_->SetInput(stats_GstALL_[1]);
    calc_y_->SetOutput(piter_i1_);
    calc_y_->SetOutput(piter_niteri1_);
    calc_y_->SetOutput(piter_ih1_);
    calc_y_->SetOutput(piter_niterih1_);
    calc_y_->SetOutput(piter_iall_);
    calc_y_->SetOutput(piter_niteriall_);
    calc_y_->SetOutput(piter_ihall_);
    calc_y_->SetOutput(piter_niterihall_);
    calc_y_->SetOutput(piter_ighall_);
    calc_y_->SetOutput(piter_niterighall_);
    calc_y_->Prepare();
  }
  calc_y_->Calculate(manager()->all_commands()->dry_run());
  calc_y_->Finalize();
  // ===========================================================================
}

void CCalcMstatspop::Permute_2(void) {
  /// ==========================================================================
  /// PERMUTE
  /// ==========================================================================
  static bool prepare = true;
  if (prepare) {
    prepare = false;
    calc_permute_2_->SetInput(int_total_nsam_);
    calc_permute_2_->SetInput(matrix_pol_);
    calc_permute_2_->SetInput(nsam2_);
    calc_permute_2_->SetInput(psam2_);
    calc_permute_2_->SetInput(length_seg_);
    calc_permute_2_->SetOutput(matrix_perm_);
    calc_permute_2_->Prepare();
  }
  calc_permute_2_->Calculate(manager()->all_commands()->dry_run());
  calc_permute_2_->Finalize();
  // ===========================================================================
}

void CCalcMstatspop::Permute_3(void) {
  /// ==========================================================================
  /// PERMUTE
  /// ==========================================================================
  static bool prepare = true;
  if (prepare) {
    prepare = false;
    calc_permute_3_->SetInput(int_total_nsam_);
    calc_permute_3_->SetInput(matrix_pol_);
    calc_permute_3_->SetInput(nsam2_);
    calc_permute_3_->SetInput(psam2_);
    calc_permute_3_->SetInput(length_seg_);
    calc_permute_3_->SetOutput(matrix_perm_);
    calc_permute_3_->Prepare();
  }
  calc_permute_3_->Calculate(manager()->all_commands()->dry_run());
  calc_permute_3_->Finalize();
  // ===========================================================================
}

void CCalcMstatspop::CalcZ(void) {
  /// ==========================================================================
  /// CALC Z
  /// ==========================================================================
  static bool prepare = true;
  if (prepare) {
    prepare = false;
    calc_z_->SetInput(ploidy_);
    calc_z_->SetInput(z_pos_);
    calc_z_->SetInput(stats_fst_[0]);
    calc_z_->SetInput(stats_fst_[1]);
    calc_z_->SetInput(stats_fsth_[0]);
    calc_z_->SetInput(stats_fsth_[1]);
    calc_z_->SetInput(stats_Gst_[0]);
    calc_z_->SetInput(stats_Gst_[1]);
    calc_z_->SetOutput(piter_i_);
    calc_z_->SetOutput(piter_niteri_);
    calc_z_->SetOutput(piter_ih_);
    calc_z_->SetOutput(piter_niterih_);
    calc_z_->SetOutput(piter_igh_);
    calc_z_->SetOutput(piter_niterigh_);
    calc_z_->Prepare();
  }
  calc_z_->Calculate(manager()->all_commands()->dry_run());
  calc_z_->Finalize();
  // ===========================================================================
}

void CCalcMstatspop::PrintOutput(void) {
  /// ==========================================================================
  /// PRINT THE OUTPUT
  /// ==========================================================================
  static bool prepare2 = true;
  if (prepare2) {
    prepare2 = false;
    calc_mstatspop_output_->SetInput(matrix_pol_);
    calc_mstatspop_output_->SetInput(matrix_pol_tcga_);
    calc_mstatspop_output_->SetInput(positions_);
    calc_mstatspop_output_->SetInput(sites_);
    calc_mstatspop_output_->SetInput(sanc_);
    calc_mstatspop_output_->SetInput(argc_);
    calc_mstatspop_output_->SetInput(file_in_);
    calc_mstatspop_output_->SetInput(file_out_);
    calc_mstatspop_output_->SetInput(gfffiles_);
    calc_mstatspop_output_->SetInput(file_GFF_);
    calc_mstatspop_output_->SetInput(subset_positions_);
    calc_mstatspop_output_->SetInput(code_name_);
    calc_mstatspop_output_->SetInput(genetic_code_);
    calc_mstatspop_output_->SetInput(length_);
    calc_mstatspop_output_->SetInput(length_al_);
    calc_mstatspop_output_->SetInput(length_al_real_);
    calc_mstatspop_output_->SetInput(niter_);
    calc_mstatspop_output_->SetInput(ploidy_);
    calc_mstatspop_output_->SetInput(include_unknown_);
    calc_mstatspop_output_->SetInput(force_outgroup_);
    calc_mstatspop_output_->SetInput(outgroup_presence_);
    calc_mstatspop_output_->SetInput(vint_perpop_nsam_);
    calc_mstatspop_output_->SetInput(npops_);
    calc_mstatspop_output_->SetInput(int_total_nsam_);
    calc_mstatspop_output_->SetInput(svratio_);
    calc_mstatspop_output_->SetInput(missratio_);
    calc_mstatspop_output_->SetInput(jfd_);
    calc_mstatspop_output_->SetInput(nfd_);
    calc_mstatspop_output_->SetInput(H1frq_);
    calc_mstatspop_output_->SetInput(H0frq_);
    calc_mstatspop_output_->SetInput(file_H1f_);
    calc_mstatspop_output_->SetInput(file_H0f_);
    calc_mstatspop_output_->SetInput(vector_priors_);
    calc_mstatspop_output_->SetInput(npriors_);
    calc_mstatspop_output_->SetInput(formatfile_);
    calc_mstatspop_output_->SetInput(freq_missing_ms_);
    calc_mstatspop_output_->SetInput(nsites1_pop_);
    calc_mstatspop_output_->SetInput(nsites1_pop_outg_);
    calc_mstatspop_output_->SetInput(nsites2_pop_);
    calc_mstatspop_output_->SetInput(nsites2_pop_outg_);
    calc_mstatspop_output_->SetInput(nsites3_pop_);
    calc_mstatspop_output_->SetInput(nsites3_pop_outg_);
    calc_mstatspop_output_->SetInput(li_);
    calc_mstatspop_output_->SetInput(r2i_ploidies_);
    calc_mstatspop_output_->SetInput(stats_piw_[0]);
    calc_mstatspop_output_->SetInput(stats_pia_[0]);
    calc_mstatspop_output_->SetInput(stats_piT_[0]);
    calc_mstatspop_output_->SetInput(stats_piant_[0]);
    calc_mstatspop_output_->SetInput(stats_piTnt_[0]);
    calc_mstatspop_output_->SetInput(stats_fst_[0]);
    calc_mstatspop_output_->SetInput(stats_piwHKY_[0]);
    calc_mstatspop_output_->SetInput(stats_piaHKY_[0]);
    calc_mstatspop_output_->SetInput(stats_piTHKY_[0]);
    calc_mstatspop_output_->SetInput(stats_fstHKY_[0]);
    calc_mstatspop_output_->SetInput(stats_fst1all_[0]);
    calc_mstatspop_output_->SetInput(stats_Gst_[0]);
    calc_mstatspop_output_->SetInput(stats_hapw_[0]);
    calc_mstatspop_output_->SetInput(stats_hapa_[0]);
    calc_mstatspop_output_->SetInput(stats_hapT_[0]);
    calc_mstatspop_output_->SetInput(stats_fsth_[0]);
    calc_mstatspop_output_->SetInput(stats_fsth1all_[0]);
    calc_mstatspop_output_->SetInput(stats_fstALL_[0]);
    calc_mstatspop_output_->SetInput(stats_fsthALL_[0]);
    calc_mstatspop_output_->SetInput(stats_GstALL_[0]);
    calc_mstatspop_output_->SetInput(stats_S_[0]);
    calc_mstatspop_output_->SetInput(stats_So_[0]);
    calc_mstatspop_output_->SetInput(stats_thetaS_[0]);
    calc_mstatspop_output_->SetInput(stats_thetaSo_[0]);
    calc_mstatspop_output_->SetInput(stats_thetaT_[0]);
    calc_mstatspop_output_->SetInput(stats_thetaTo_[0]);
    calc_mstatspop_output_->SetInput(stats_thetaTHKY_[0]);
    calc_mstatspop_output_->SetInput(stats_thetaFL_[0]);
    calc_mstatspop_output_->SetInput(stats_thetaFW_[0]);
    calc_mstatspop_output_->SetInput(stats_thetaL_[0]);
    calc_mstatspop_output_->SetInput(stats_thetaSA_[0]);
    calc_mstatspop_output_->SetInput(stats_thetaTA_[0]);
    calc_mstatspop_output_->SetInput(stats_K_[0]);
    calc_mstatspop_output_->SetInput(stats_KHKY_[0]);
    calc_mstatspop_output_->SetInput(stats_Dtaj_[0]);
    calc_mstatspop_output_->SetInput(stats_Dfl_[0]);
    calc_mstatspop_output_->SetInput(stats_Ffl_[0]);
    calc_mstatspop_output_->SetInput(stats_Hnfw_[0]);
    calc_mstatspop_output_->SetInput(stats_Ez_[0]);
    calc_mstatspop_output_->SetInput(stats_Yach_[0]);
    calc_mstatspop_output_->SetInput(stats_R2_[0]);
    calc_mstatspop_output_->SetInput(stats_Fs_[0]);
    calc_mstatspop_output_->SetInput(stats_Rm_[0]);
    calc_mstatspop_output_->SetInput(stats_ZnA_[0]);
    calc_mstatspop_output_->SetInput(stats_freq_[0]);
    calc_mstatspop_output_->SetInput(stats_nh_[0]);
    calc_mstatspop_output_->SetInput(stats_nhpop_[0]);
    calc_mstatspop_output_->SetInput(stats_freqh_[0]);
    calc_mstatspop_output_->SetInput(stats_length_[0]);
    calc_mstatspop_output_->SetInput(stats_length2_[0]);
    calc_mstatspop_output_->SetInput(stats_lengthamng_[0]);
    calc_mstatspop_output_->SetInput(stats_total_length_[0]);
    calc_mstatspop_output_->SetInput(stats_total_real_length_[0]);
    calc_mstatspop_output_->SetInput(stats_total_svratio_[0]);
    calc_mstatspop_output_->SetInput(stats_total_tcga_[0]);
    calc_mstatspop_output_->SetInput(stats_tcga_[0]);
    calc_mstatspop_output_->SetInput(stats_sv_[0]);
    calc_mstatspop_output_->SetInput(stats_svT_[0]);
    calc_mstatspop_output_->SetInput(stats_nmhits_[0]);
    calc_mstatspop_output_->SetInput(stats_H1freq_[0]);
    calc_mstatspop_output_->SetInput(stats_thetaH1_[0]);
    calc_mstatspop_output_->SetInput(stats_H0freq_[0]);
    calc_mstatspop_output_->SetInput(stats_thetaH0_[0]);
    calc_mstatspop_output_->SetInput(stats_ToH0_ii_[0]);
    calc_mstatspop_output_->SetInput(stats_ToH0_00_[0]);
    calc_mstatspop_output_->SetInput(stats_To_ii_[0]);
    calc_mstatspop_output_->SetInput(stats_To_00_[0]);
    calc_mstatspop_output_->SetInput(stats_To_i0_[0]);
    calc_mstatspop_output_->SetInput(stats_To_Qc_ii_[0]);
    calc_mstatspop_output_->SetInput(stats_To_Qw_ii_[0]);
    calc_mstatspop_output_->SetInput(stats_To_Lc_ii_[0]);
    calc_mstatspop_output_->SetInput(stats_mdsd_[0]);
    calc_mstatspop_output_->SetInput(stats_mdg1_[0]);
    calc_mstatspop_output_->SetInput(stats_mdg2_[0]);
    calc_mstatspop_output_->SetInput(stats_mdw_[0]);
    calc_mstatspop_output_->SetInput(stats_linefreq_[0]);
    calc_mstatspop_output_->SetInput(stats_anx_[0]);
    calc_mstatspop_output_->SetInput(stats_bnx_[0]);
    calc_mstatspop_output_->SetInput(stats_anxo_[0]);
    calc_mstatspop_output_->SetInput(stats_bnxo_[0]);
    calc_mstatspop_output_->SetInput(stats_R2p_[0]);
    calc_mstatspop_output_->SetInput(piter_i_);
    calc_mstatspop_output_->SetInput(piter_ih_);
    calc_mstatspop_output_->SetInput(piter_igh_);
    calc_mstatspop_output_->SetInput(piter_i1_);
    calc_mstatspop_output_->SetInput(piter_ih1_);
    calc_mstatspop_output_->SetInput(piter_niteri_);
    calc_mstatspop_output_->SetInput(piter_niterih_);
    calc_mstatspop_output_->SetInput(piter_niterigh_);
    calc_mstatspop_output_->SetInput(piter_niteri1_);
    calc_mstatspop_output_->SetInput(piter_niterih1_);
    calc_mstatspop_output_->SetInput(piter_iall_);
    calc_mstatspop_output_->SetInput(piter_ihall_);
    calc_mstatspop_output_->SetInput(piter_ighall_);
    calc_mstatspop_output_->SetInput(piter_niteriall_);
    calc_mstatspop_output_->SetInput(piter_niterihall_);
    calc_mstatspop_output_->SetInput(piter_niterighall_);
    calc_mstatspop_output_->SetInput(output_);
    calc_mstatspop_output_->SetInput(seed_);
    calc_mstatspop_output_->SetInput(length_seg_);
    calc_mstatspop_output_->Prepare();
  }
  calc_mstatspop_output_->Calculate(manager()->all_commands()->dry_run());
  calc_mstatspop_output_->Finalize();
  // ===========================================================================
  
  ConcatenateIterationResults();
}

void CCalcMstatspop::DataMemoryAllocation(long int npops,
                                         long int int_total_nsam,
                                         int outgroup_presence) {
  /**
   * Non DM data is automatically free when this calculation is finished.
   * DM data is automatically free when the ngaSP application is closed.
   */
  
  nsam2_->ReserveMemory(2, 0);
  psam2_->ReserveMemory(2, 0);
  nsites1_pop_->ReserveMemory(npops, 0);
  nsites2_pop_->ReserveMemory(npops, 0);
  nsites3_pop_->ReserveMemory(npops, 0);
  nsites1_pop_outg_->ReserveMemory(npops, 0);
  nsites2_pop_outg_->ReserveMemory(npops, 0);
  nsites3_pop_outg_->ReserveMemory(npops, 0);
  anx_->ReserveMemory(npops, 0);
  bnx_->ReserveMemory(npops, 0);
  anxo_->ReserveMemory(npops, 0);
  bnxo_->ReserveMemory(npops, 0);
  lengthamng_->ReserveMemory(npops, npops, 0.0);
  sum_sam_->ReserveMemory(int_total_nsam + !outgroup_presence, 0);
  tcga_->ReserveMemory(int_total_nsam + !outgroup_presence, 4, 0);

  stats_piw_[0]->ReserveMemory(npops, 0.0);
  stats_pia_[0]->ReserveMemory((npops*(npops-0))/2, 0.0);
  stats_piT_[0]->ReserveMemory((npops*(npops-0))/2, 0.0);
  stats_piant_[0]->ReserveMemory((npops*(npops-0))/2, 0.0);
  stats_piTnt_[0]->ReserveMemory((npops*(npops-0))/2, 0.0);
  stats_fst_[0]->ReserveMemory((npops*(npops-0))/2, 0.0);
  stats_piwHKY_[0]->ReserveMemory(npops, 0.0);
  stats_piaHKY_[0]->ReserveMemory((npops*(npops-0))/2, 0.0);
  stats_piTHKY_[0]->ReserveMemory((npops*(npops-0))/2, 0.0);
  stats_fstHKY_[0]->ReserveMemory((npops*(npops-0))/2, 0.0);
  stats_fst1all_[0]->ReserveMemory((npops*(npops-0))/2, 0.0);
  stats_Gst_[0]->ReserveMemory((npops*(npops-0))/2, 0.0);
  stats_hapw_[0]->ReserveMemory(npops, 0.0);
  stats_hapa_[0]->ReserveMemory((npops*(npops-0))/2, 0.0);
  stats_hapT_[0]->ReserveMemory((npops*(npops-0))/2, 0.0);
  stats_fsth_[0]->ReserveMemory((npops*(npops-0))/2, 0.0);
  stats_fsth1all_[0]->ReserveMemory((npops*(npops-0))/2, 0.0);
  stats_S_[0]->ReserveMemory(npops, 0.0);
  stats_So_[0]->ReserveMemory(npops, 0.0);
  stats_thetaS_[0]->ReserveMemory(npops, 0.0);
  stats_thetaSo_[0]->ReserveMemory(npops, 0.0);
  stats_thetaT_[0]->ReserveMemory(npops, 0.0);
  stats_thetaTo_[0]->ReserveMemory(npops, 0.0);
  stats_thetaTHKY_[0]->ReserveMemory(npops, 0.0);
  stats_thetaFL_[0]->ReserveMemory(npops, 0.0);
  stats_thetaFW_[0]->ReserveMemory(npops, 0.0);
  stats_thetaL_[0]->ReserveMemory(npops, 0.0);
  stats_thetaSA_[0]->ReserveMemory(npops, 0.0);
  stats_thetaTA_[0]->ReserveMemory(npops, 0.0);
  stats_K_[0]->ReserveMemory(npops, 0.0);
  stats_KHKY_[0]->ReserveMemory(npops, 0.0);
  stats_Dtaj_[0]->ReserveMemory(npops, 0.0);
  stats_Dfl_[0]->ReserveMemory(npops, 0.0);
  stats_Ffl_[0]->ReserveMemory(npops, 0.0);
  stats_Hnfw_[0]->ReserveMemory(npops, 0.0);
  stats_Ez_[0]->ReserveMemory(npops, 0.0);
  stats_Yach_[0]->ReserveMemory(npops, 0.0);
  stats_R2_[0]->ReserveMemory(npops, 0.0);
  stats_Fs_[0]->ReserveMemory(npops, 0.0);
  stats_Rm_[0]->ReserveMemory(npops, 0);
  stats_ZnA_[0]->ReserveMemory(npops, 0.0);
  stats_freq_[0]->ReserveMemory(npops, (*vint_perpop_nsam_).GetData(), 0.0);
  stats_freqh_[0]->ReserveMemory(npops, int_total_nsam, 0);
  stats_nhpop_[0]->ReserveMemory(npops, 0);
  stats_length_[0]->ReserveMemory(npops, 0.0);
  stats_length2_[0]->ReserveMemory(npops, 0.0);
  stats_lengthamng_[0]->ReserveMemory(npops, npops, 0.0);
  stats_total_tcga_[0]->ReserveMemory(4, 0.0);
  stats_tcga_[0]->ReserveMemory(npops, 4, 0.0);
  stats_sv_[0]->ReserveMemory(npops, npops, 2, 0.0);
  stats_svT_[0]->ReserveMemory(npops, npops, 2, 0.0);
  stats_ToH0_ii_[0]->ReserveMemory(npops, 0.0);
  stats_ToH0_00_[0]->ReserveMemory(npops, 0.0);
  stats_To_ii_[0]->ReserveMemory(npops, 0.0);
  stats_To_00_[0]->ReserveMemory(npops, 0.0);
  stats_To_i0_[0]->ReserveMemory(npops, 0.0);
  stats_To_Qc_ii_[0]->ReserveMemory(npops, 0.0);
  stats_To_Qw_ii_[0]->ReserveMemory(npops, 0.0);
  stats_To_Lc_ii_[0]->ReserveMemory(npops, 0.0);
  stats_mdsd_[0]->ReserveMemory(npops, 0.0);
  stats_mdg1_[0]->ReserveMemory(npops, 0.0);
  stats_mdg2_[0]->ReserveMemory(npops, 0.0);
  stats_linefreq_[0]->ReserveMemory(int_total_nsam, int_total_nsam + 1, 0.0);
  stats_anx_[0]->ReserveMemory(npops, 0.0);
  stats_bnx_[0]->ReserveMemory(npops, 0.0);
  stats_anxo_[0]->ReserveMemory(npops, 0.0);
  stats_bnxo_[0]->ReserveMemory(npops, 0.0);
  stats_mdw_[0]->ReserveMemory(npops, (*mdw_reg_lengths_).GetData(), 0.0);
  stats_piw_[1]->ReserveMemory(npops, 0.0);
  stats_pia_[1]->ReserveMemory((npops*(npops-0))/2, 0.0);
  stats_piT_[1]->ReserveMemory((npops*(npops-0))/2, 0.0);
  stats_fst_[1]->ReserveMemory((npops*(npops-0))/2, 0.0);
  stats_piwHKY_[1]->ReserveMemory(npops, 0.0);
  stats_piaHKY_[1]->ReserveMemory((npops*(npops-0))/2, 0.0);
  stats_piTHKY_[1]->ReserveMemory((npops*(npops-0))/2, 0.0);
  stats_fstHKY_[1]->ReserveMemory((npops*(npops-0))/2, 0.0);
  stats_fst1all_[1]->ReserveMemory((npops*(npops-0))/2, 0.0);
  stats_hapw_[1]->ReserveMemory(npops, 0.0);
  stats_hapa_[1]->ReserveMemory((npops*(npops-0))/2, 0.0);
  stats_hapT_[1]->ReserveMemory((npops*(npops-0))/2, 0.0);
  stats_fsth_[1]->ReserveMemory((npops*(npops-0))/2, 0.0);
  stats_fsth1all_[1]->ReserveMemory((npops*(npops-0))/2, 0.0);
  stats_Gst_[1]->ReserveMemory((npops*(npops-0))/2, 0.0);
  stats_K_[1]->ReserveMemory(npops, 0.0);
  stats_KHKY_[1]->ReserveMemory(npops, 0.0);
  stats_sv_[1]->ReserveMemory(npops, npops, 2, 0.0);
  stats_svT_[1]->ReserveMemory(npops, npops, 2, 0.0);
  stats_nhpop_[1]->ReserveMemory(npops, 0.0);
  stats_freqh_[1]->ReserveMemory(npops, int_total_nsam, 0.0);
  stats_tcga_[1]->ReserveMemory(npops, 4, 0.0);
  stats_length_[1]->ReserveMemory(npops, 0.0);
  stats_length2_[1]->ReserveMemory(npops, 0.0);
  stats_lengthamng_[1]->ReserveMemory(npops, npops, 0.0);

  piter_i1_->ReserveMemory(npops, 0);
  piter_ih1_->ReserveMemory(npops, 0);
  piter_i_->ReserveMemory((npops*(npops-0))/2, 0);
  piter_ih_->ReserveMemory((npops*(npops-0))/2, 0);
  piter_igh_->ReserveMemory((npops*(npops-0))/2, 0);
  piter_niteri1_->ReserveMemory(npops, 0);
  piter_niterih1_->ReserveMemory(npops, 0);
  piter_niteri_->ReserveMemory((npops*(npops-0))/2, 0);
  piter_niterih_->ReserveMemory((npops*(npops-0))/2, 0);
  piter_niterigh_->ReserveMemory((npops*(npops-0))/2, 0);
  
  for(int x=0;x<npops_->value();x++) {
      for(int w=0;w<4;w++) {
          (*stats_tcga_[1])[x][w] = (*stats_tcga_[0])[x][w];
      }
  }

  stats_total_length_[1]->set_value(length_al_->value());
  stats_total_svratio_[1]->set_value(svratio_->value());
  stats_nmhits_[1]->set_value(nmhits_->value()); 
  piter_iall_->set_value(0);
  piter_ihall_->set_value(0);
  piter_ighall_->set_value(0);
  piter_niteriall_->set_value(0);
  piter_niterihall_->set_value(0);
  piter_niterighall_->set_value(0);

  if(int_total_nsam_order_->value() == 0) {
    int_total_nsam_order_->set_value(int_total_nsam_->value()-!outgroup_presence_->value());
    sort_nsam_->ReserveMemory(int_total_nsam, 0);
    for(int sort_index = 0;
        sort_index < int_total_nsam_->value(); sort_index++ ) {
      (*sort_nsam_)[sort_index] = sort_index;
    }
  }
}

void CCalcMstatspop::DeleteIterationVariables(void) {
  matrix_pol_->DeleteMemory();
  frequencies_->DeleteMemory();
  positions_->DeleteMemory();
  matrix_sv_->DeleteMemory();
  sites_->DeleteMemory();
  jfd_->DeleteMemory();
  nfd_->DeleteMemory();
  
  if (!(file_mas_->value()[0] == '-') && ((formatfile_->value() == MS_FILE) ||
      (formatfile_->value() == MS_X_FILE))) {
    sum_sam_mask_->DeleteMemory();
  } else {
    matrix_pol_tcga_->DeleteMemory();
  }
}

void CCalcMstatspop::ShowMstatspopInformation(void) {
  /**
   * Print Header.
   */
  if ((output_->value() == 0) || (output_->value() == 10)) {
    fprintf(manager()->foutput(), STR(MSTATSPOP_DESC).c_str());
    fprintf(manager()->foutput(), STR(EOL).c_str());
    fprintf(manager()->foutput(), all_command_line_->value().c_str());
    fprintf(manager()->foutput(), STR(SPACE).c_str());
    fprintf(manager()->foutput(), STR(MSTATSPOP_OUTPUT_TITLE).c_str());
  }
}

void CCalcMstatspop::Print(std::string message) {
  /**
   * Show a message to the user.
   */
  if (output_->value() == 0 || output_->value() == 10) {
    fprintf(manager()->foutput(), message.c_str());
    fprintf(manager()->foutput(), STR(EOL).c_str());
    fflush(manager()->foutput());
  }
}

void CCalcMstatspop::ChangeUserInputsIfNecessary(void) {
  /**
   * Set the length_al_:
   */
  if ((formatfile_->value() == MS_FILE) || (formatfile_->value() == MS_X_FILE)) {
    length_al_->set_value(length_->value());
  }

  /**
	 * introduce the data and mask file (last if necessary)
	 */
	if (mask_print_->value() == 1 && (formatfile_->value() == FASTA_FILE ||
     (formatfile_->value() == TFASTA_FILE && ((slide_->value() == 0 && window_->value() == 0) && 
      file_wcoord_->value() == "")))) {
       
		if (file_in_->value() == "") {
      file_mas_->set_value(STR(DEFAULT_MASK_FILE_NAME_START) + STR(MASK_POPS_MARK) + CStringTools::ToString(npops_->value()-!outgroup_presence_->value()) + "_nsam" + CStringTools::ToString(int_total_nsam_->value()-!outgroup_presence_->value()));
    } else {
      file_mas_->set_value(CFile::GetPathFileNameWithoutExtension(file_in_->value()) + STR(MASK_POPS_MARK) + CStringTools::ToString(npops_->value()-!outgroup_presence_->value()) + "_nsam" + CStringTools::ToString(int_total_nsam_->value()-!outgroup_presence_->value()));
    }
      
    if (gfffiles_->value() == YES) {
      file_mas_->add(STR(CONTINUE_LINE) + subset_positions_->GetDataString(false));
      file_mas_->add(STR(CONTINUE_LINE) + criteria_transcript_->GetDataString(false));
    }

    if(!include_unknown_->value()) {
      file_mas_->add(STR(MASK_EXCLUDE_MIS_VARIANTS_MARK));
    }
    else {
      file_mas_->add(STR(MASK_INCLUDE_MIS_VARIANTS_MARK));
    }

    if(outgroup_presence_->value() == NO) {
      file_mas_->add(STR(MASK_NO_OUTGROUP_PRESENCE_MARK));
    }

    if(outgroup_presence_->value() == YES) {
      file_mas_->add(STR(MASK_OUTGROUP_PRESENCE_MARK));
    }

    if(ploidy_->value() == HAPLOID) {
      file_mas_->add(STR(MASK_PLOIDY_1_MARK));
    }

    if(ploidy_->value() == DIPLOID) {
      file_mas_->add(STR(MASK_PLOIDY_2_MARK));
    }            

    file_mas_->add(STR(DEFAULT_MASK_FILE_NAME_END));
	}

  /**
	 * Set the genetic_code_:
	 */  
  if ((gfffiles_->value() == YES) && (
      (subset_positions_->GetDataString(false) == STR(SUBSET_POS_SYNONYMOUS)) ||
      (subset_positions_->GetDataString(false) == STR(SUBSET_POS_NONSYNONYMOUS)) ||
      (subset_positions_->GetDataString(false) == STR(SUBSET_POS_0_FOLD)) ||
      (subset_positions_->GetDataString(false) == STR(SUBSET_POS_2_FOLD)) ||
      (subset_positions_->GetDataString(false) == STR(SUBSET_POS_3_FOLD)) ||
      (subset_positions_->GetDataString(false) == STR(SUBSET_POS_4_FOLD)) ||
      (subset_positions_->GetDataString(false) == STR(SUBSET_POS_SILENT)))) {
    CDnaTools dna_tools;
    genetic_code_->set_text_string(
    dna_tools.genetic_codes_[(*code_name_).GetDataString(false)]);
  }  
}

void CCalcMstatspop::AddOneOutgroupIfItIsNotPresent(void) {
  /**
   * Add one outgroup at the end if it is not present:
   */
  if (outgroup_presence_->value() == NO) {
    populations_initial_->set_value(populations_initial_->value() + ",1");
    CreateThePopulationsVector();
  }
}

void CCalcMstatspop::CreateThePopulationsVector(void) {
  /**
   * Create the populations vector:
   */
  vint_perpop_nsam_->set_data_string(populations_initial_->value());
  npops_->set_value(vint_perpop_nsam_->reg_length());
  int_total_nsam_->set_value(0);
  for (std::size_t i = 0; i < vint_perpop_nsam_->reg_length(); i++) {
    int_total_nsam_->add((*vint_perpop_nsam_)[i]);
  }
}

void CCalcMstatspop::Calculate(bool dry_run) {
  if (dry_run == true) {
    return;
  }
  
  if (ploidy_->value() == 9999) {
    
    out_stats_thetaSo_->ReserveMemory(10);
    (*out_stats_thetaSo_)[0]  = 10.2;
    (*out_stats_thetaSo_)[1]  = 14.1;
    (*out_stats_thetaSo_)[2]  = 14.4;
    (*out_stats_thetaSo_)[3]  = 14.4;
    (*out_stats_thetaSo_)[4]  = 14.4;
    (*out_stats_thetaSo_)[5]  = 14.5;
    (*out_stats_thetaSo_)[6]  = 14.5;
    (*out_stats_thetaSo_)[7]  = 14.6;
    (*out_stats_thetaSo_)[8]  = 14.7;
    (*out_stats_thetaSo_)[9]  = 14.7;
    
      
    out_stats_thetaTo_->ReserveMemory(10);
    (*out_stats_thetaTo_)[0]  = 12.2;
    (*out_stats_thetaTo_)[1]  = 10.2;
    (*out_stats_thetaTo_)[2]  = 13.5;
    (*out_stats_thetaTo_)[3]  = 10.8;
    (*out_stats_thetaTo_)[4]  = 10.2;
    (*out_stats_thetaTo_)[5]  = 11.9;
    (*out_stats_thetaTo_)[6]  = 14.1;
    (*out_stats_thetaTo_)[7]  = 10.1;
    (*out_stats_thetaTo_)[8]  = 14.2;
    (*out_stats_thetaTo_)[9]  = 13.1;
      
    out_stats_thetaFL_->ReserveMemory(10);
    (*out_stats_thetaFL_)[0]  = 14.2;
    (*out_stats_thetaFL_)[1]  = 17.1;
    (*out_stats_thetaFL_)[2]  = 10.2;
    (*out_stats_thetaFL_)[3]  = 14.2;
    (*out_stats_thetaFL_)[4]  = 14.1;
    (*out_stats_thetaFL_)[5]  = 16.2;
    (*out_stats_thetaFL_)[6]  = 10.3;
    (*out_stats_thetaFL_)[7]  = 17.2;
    (*out_stats_thetaFL_)[8]  = 10.4;
    (*out_stats_thetaFL_)[8]  = 10.2;
    
//    out_stats_thetaSo_->ReserveMemory(50);
//    (*out_stats_thetaSo_)[0]  = 0.6169396779;
//    (*out_stats_thetaSo_)[1]  = 0.3879355218;
//    (*out_stats_thetaSo_)[2]  = 0.6449574078;
//    (*out_stats_thetaSo_)[3]  = 0.3301015845;
//    (*out_stats_thetaSo_)[4]  = 0.9060996957;
//    (*out_stats_thetaSo_)[5]  = 0.7660798724;
//    (*out_stats_thetaSo_)[6]  = 0.5288387279;
//    (*out_stats_thetaSo_)[7]  = 0.5953108147;
//    (*out_stats_thetaSo_)[8]  = 0.4246015144;
//    (*out_stats_thetaSo_)[9]  = 0.5384472767;
//    (*out_stats_thetaSo_)[10] = 0.6369394413;
//    (*out_stats_thetaSo_)[11] = 0.2554357557;
//    (*out_stats_thetaSo_)[12] = 0.9747845964;
//    (*out_stats_thetaSo_)[13] = 0.6778923008;
//    (*out_stats_thetaSo_)[14] = 0.6692839197;
//    (*out_stats_thetaSo_)[15] = 0.3125942259;
//    (*out_stats_thetaSo_)[16] = 0.3486516115;
//    (*out_stats_thetaSo_)[17] = 0.8161872111;
//    (*out_stats_thetaSo_)[18] = 0.7593945917;
//    (*out_stats_thetaSo_)[19] = 0.9101226178;
//    (*out_stats_thetaSo_)[20] = 0.0792233136;
//    (*out_stats_thetaSo_)[21] = 0.4318759665;
//    (*out_stats_thetaSo_)[22] = 0.9059657105;
//    (*out_stats_thetaSo_)[23] = 0.5881429177;
//    (*out_stats_thetaSo_)[24] = 0.9349069421;
//    (*out_stats_thetaSo_)[25] = 0.0671722793;
//    (*out_stats_thetaSo_)[26] = 0.8360115506;
//    (*out_stats_thetaSo_)[27] = 0.3825655235;
//    (*out_stats_thetaSo_)[28] = 0.6497709046;
//    (*out_stats_thetaSo_)[29] = 0.1516913939;
//    (*out_stats_thetaSo_)[30] = 0.3293712169;
//    (*out_stats_thetaSo_)[31] = 0.2434537499;
//    (*out_stats_thetaSo_)[32] = 0.3997380619;
//    (*out_stats_thetaSo_)[33] = 0.3096994599;
//    (*out_stats_thetaSo_)[34] = 0.8701144806;
//    (*out_stats_thetaSo_)[35] = 0.799414488;
//    (*out_stats_thetaSo_)[36] = 0.066311239;
//    (*out_stats_thetaSo_)[37] = 0.9331763927;
//    (*out_stats_thetaSo_)[38] = 0.9820265204;
//    (*out_stats_thetaSo_)[39] = 0.9498630383;
//    (*out_stats_thetaSo_)[40] = 0.7020445282;
//    (*out_stats_thetaSo_)[41] = 0.254200313;
//    (*out_stats_thetaSo_)[42] = 0.4232235076;
//    (*out_stats_thetaSo_)[43] = 0.3470113825;
//    (*out_stats_thetaSo_)[44] = 0.1752535223;
//    (*out_stats_thetaSo_)[45] = 0.4016582484;
//    (*out_stats_thetaSo_)[46] = 0.1952459556;
//    (*out_stats_thetaSo_)[47] = 0.417040312;
//    (*out_stats_thetaSo_)[48] = 0.0350911166;
//    (*out_stats_thetaSo_)[49] = 0.6239836277;
    return;
  }

/// ============================================================================
/// CALCULATE - MSTATSTPOP MAIN FUNCTION
/// ============================================================================
   
  CreateThePopulationsVector();
  
  ChangeUserInputsIfNecessary();

  GetSumOfPopulations();

  AddOneOutgroupIfItIsNotPresent();

  /*ordering data: in case O is not a flag included*/
  if(int_total_nsam_order_->value() > 0 && int_total_nsam_order_->value()+!outgroup_presence_->value() != int_total_nsam_->value()) {
    ERROR_MSG << STR(SORT_NSAM_ERROR)
              END_MSG;
  }
  
  MultiplyPopulationsDependingOnPloidy();
      
  CalcMdwRegLengths();

  ICalculation *calc_randomize_ = NULL;
  DM_GET_CALC(calc_randomize_)
  if (calc_randomize_ != NULL) {
    (static_cast<CCalcRandomize *>(calc_randomize_))->InitSeed(seed_->value());
  }  else {
    ERROR_MSG << "CCalcMstatspop::" << "Randomize does not exist..." END_MSG;
  }
 
 
  DataMemoryAllocation(npops_->value(),
                       int_total_nsam_->value(),
                       outgroup_presence_->value());

 
  if (file_wps_->value() != "") {
    ReadWeightPositionsFile();
  } else {
    wP_->DeleteMemory();
  }
  
  if (file_wcoord_->value() != "") {
    ReadCoordinatesFile();
    window_->set_value(-1);
	  slide_->set_value(-1);
  } else {
    nwindows_->set_value(0);
  }

  if (file_effsz_->value() != "") {
    ReadEffectSizesFile();
    
    if(wlimit_end_->value() > 0 && welimit_end_->value() > 0) {
      if(wlimit_end_->value() != welimit_end_->value()) {
        ERROR_MSG << STR(ERROR_POSITION_LENGTHS)
                  END_MSG;
      }
    }    
  } else {
    wV_->DeleteMemory();
  }

  ShowMstatspopInformation();
  
  OpenAlternativeAndFreqSpectrumFile();

  if (formatfile_->value() == FASTA_FILE) {
    ReadFastaFile();

		/*define variables for mhits*/
		nmhits_->set_value(0);
    mhitbp_->ReserveMemory(n_site_->value(), 0);
    
    
    if (gfffiles_->value() == YES) {
      FilterDnaMatrixWithGFFFile();
    }

    CalculateStats();
    
    niterdata_->set_value(1);
  }

  if ((formatfile_->value() == MS_FILE) ||
      (formatfile_->value() == MS_X_FILE)) {
      svratio_->set_value(ms_svratio_->value());
      MsMaskFile();
  }

  li_->set_value(0);
  
  while(li_->value() < niterdata_->value()) {
    flaghky_->set_value(1);
    
    if ((formatfile_->value() == MS_FILE) ||
        (formatfile_->value() == MS_X_FILE)) {
      OpenMsFile();

      CalcX();
    }

    if (formatfile_->value() == TFASTA_FILE) {
      if (ReadTFastaFile() == false) {
        /*printf("End processing input tfa data.\n");*/
        break;
      }
      // When the tfa file is finished then li=0,
      // otherwise li=-1 and the loop continue.
      
      CalculateStats();
    }
    
    CalEffectiveNucleotidesAndTCGAFreqs();

    IncludeLengthMngAndCalculations();

    CalcSxsfss();

    CalcJointFreqDistribution();

    CalcPiwpiafst_1();

    CalcFrequencyStats();

    if ((H1frq_->value()) && (include_unknown_->value() == NO)) {
      CalcOptimalTests();
    }

    CalcR2();

    CalcR2p();

    CalcMismatch();

    if (ploidy_->value() == HAPLOID) {
      CalcHwhafsth_1();
      CalcFs();
    }

    /* Un monton de cosas casi-repes que volvemos a utilizar! */
    /* PERMUTATION */
    /* Only if not MS format */    

    if ((niter_->value()) && (npops_->value() > 2)) {
      // =======================================================================
      // Initialize
      // =======================================================================
  
//      stats_piw_[1]->InitMemory(0.);
//      stats_pia_[1]->InitMemory(0.);
//      stats_piT_[1]->InitMemory(0.);
//      stats_fst_[1]->InitMemory(0.);
//      stats_piwHKY_[1]->InitMemory(0.);
//      stats_piaHKY_[1]->InitMemory(0.);
//      stats_piTHKY_[1]->InitMemory(0.);
//      stats_fstHKY_[1]->InitMemory(0.);
//      stats_fst1all_[1]->InitMemory(0.);
//      stats_hapw_[1]->InitMemory(0.);
//      stats_hapa_[1]->InitMemory(0.);
//      stats_hapT_[1]->InitMemory(0.);
//      stats_fsth_[1]->InitMemory(0.);
//      stats_fsth1all_[1]->InitMemory(0.);
//      stats_Gst_[1]->InitMemory(0.);
//      stats_K_[1]->InitMemory(0.);
//      stats_KHKY_[1]->InitMemory(0.);
//      stats_freq_[1] = 0;
//      stats_sv_[1]->InitMemory(0.);
//      stats_svT_[1]->InitMemory(0.);
//      stats_nhpop_[1]->InitMemory(0);
//      stats_freqh_[1]->InitMemory(0);
//      stats_tcga_[1]->InitMemory(0.);
//      stats_length_[1]->InitMemory(0.);
//      stats_length2_[1]->InitMemory(0.);
//      stats_lengthamng_[1]->InitMemory(0.);
      
      stats_piw_[1]->ReserveMemory(npops_->value());
      stats_pia_[1]->ReserveMemory((npops_->value()*(npops_->value()-0))/2);
      stats_piT_[1]->ReserveMemory((npops_->value()*(npops_->value()-0))/2);
      stats_fst_[1]->ReserveMemory((npops_->value()*(npops_->value()-0))/2);
      stats_piwHKY_[1]->ReserveMemory(npops_->value());
      stats_piaHKY_[1]->ReserveMemory((npops_->value()*(npops_->value()-0))/2);
      stats_piTHKY_[1]->ReserveMemory((npops_->value()*(npops_->value()-0))/2);
      stats_fstHKY_[1]->ReserveMemory((npops_->value()*(npops_->value()-0))/2);
      stats_fst1all_[1]->ReserveMemory((npops_->value()*(npops_->value()-0))/2);
      stats_hapw_[1]->ReserveMemory(npops_->value());
      stats_hapa_[1]->ReserveMemory((npops_->value()*(npops_->value()-0))/2);
      stats_hapT_[1]->ReserveMemory((npops_->value()*(npops_->value()-0))/2);
      stats_fsth_[1]->ReserveMemory((npops_->value()*(npops_->value()-0))/2);
      stats_fsth1all_[1]->ReserveMemory((npops_->value()*(npops_->value()-0))/2);
      stats_Gst_[1]->ReserveMemory((npops_->value()*(npops_->value()-0))/2);
      stats_K_[1]->ReserveMemory(npops_->value());
      stats_KHKY_[1]->ReserveMemory(npops_->value());
      stats_sv_[1]->ReserveMemory(npops_->value(), npops_->value(), 2);
      stats_svT_[1]->ReserveMemory(npops_->value(), npops_->value(), 2);
      stats_nhpop_[1]->ReserveMemory(npops_->value());
      stats_freqh_[1]->ReserveMemory(npops_->value(), int_total_nsam_->value());
      stats_tcga_[1]->ReserveMemory(npops_->value(), 4);
      stats_length_[1]->ReserveMemory(npops_->value());
      stats_length2_[1]->ReserveMemory(npops_->value());
      stats_lengthamng_[1]->ReserveMemory(npops_->value(), npops_->value());

      
      for(int x=0;x<npops_->value();x++) {
          for(int w=0;w<4;w++) {
              (*stats_tcga_[1])[x][w] = (*stats_tcga_[0])[x][w];
          }
      }        

      stats_total_length_[1]->set_value(length_al_->value());
      stats_total_svratio_[1]->set_value(svratio_->value());
      stats_nmhits_[1]->set_value(nmhits_->value());
      
//      piter_i1_->InitMemory(0.);
//      piter_ih1_->InitMemory(0.);
//      piter_i_->InitMemory(0.);
//      piter_ih_->InitMemory(0.);
//      piter_igh_->InitMemory(0.);
//      piter_niteri1_->InitMemory(0.);
//      piter_niterih1_->InitMemory(0.);
//      piter_niteri_->InitMemory(0.);
//      piter_niterih_->InitMemory(0.);
//      piter_niterigh_->InitMemory(0.);      
      
      piter_i1_->ReserveMemory(npops_->value());
      piter_ih1_->ReserveMemory(npops_->value());
      piter_i_->ReserveMemory((npops_->value()*(npops_->value()-0))/2);
      piter_ih_->ReserveMemory((npops_->value()*(npops_->value()-0))/2);
      piter_igh_->ReserveMemory((npops_->value()*(npops_->value()-0))/2);
      piter_niteri1_->ReserveMemory(npops_->value());
      piter_niterih1_->ReserveMemory(npops_->value());
      piter_niteri_->ReserveMemory((npops_->value()*(npops_->value()-0))/2);
      piter_niterih_->ReserveMemory((npops_->value()*(npops_->value()-0))/2);
      piter_niterigh_->ReserveMemory((npops_->value()*(npops_->value()-0))/2);
  
      piter_iall_->set_value(0);
      piter_ihall_->set_value(0);
      piter_ighall_->set_value(0);
      piter_niteriall_->set_value(0);
      piter_niterihall_->set_value(0);
      piter_niterighall_->set_value(0);

      matrix_perm_->ReserveMemory(length_seg_->value() * int_total_nsam_->value());
      
      // =======================================================================

      Print(STR(CALCULATING_PERMUTATION_TESTS));

      /**
       * permute 1 pop against rest pops (1 vs all rest (or 2 vs all rest),
       * that means ALL mixed). Do once is enough
       */
      if (npops_->value() > 2) {
        for (int i1 = 0; i1 < niter_->value(); i1++) {
          (*nsam2_)[0] = (*vint_perpop_nsam_)[0];
          (*nsam2_)[1] =
                      int_total_nsam_->value() -
                      (*vint_perpop_nsam_)[npops_->value()-1] -
                      (*vint_perpop_nsam_)[0];
          (*psam2_)[0] = 0;
          (*psam2_)[1] = (*vint_perpop_nsam_)[0];


          Permute_2();

          /*HERE WE ASSUME THAT THE LENGTH SIZE ARE THE SAME THAN FOR ORIGINAL SAMPLES!!*/
          for(int x=0;x<npops_->value();x++) {
              (*stats_length_[1])[x]  = (*stats_length_[0])[x];
              (*stats_length2_[1])[x] = (*stats_length2_[0])[x];

              for(int y_ite=0;y_ite<npops_->value();y_ite++) {
                  (*stats_lengthamng_[1])[x][y_ite] = (*stats_lengthamng_[0])[x][y_ite];
              }
          }            

          CalcPiwpiafst_2();

          if (ploidy_->value() == HAPLOID) {
            CalcHwhafsth_2();
          }
          CalcY();
        }

        Print(STR(PERMUTATION_TESTS_DONE));
      }

      Print(STR(CALCULATING_PERMUTATION_TESTS_PAIR));

      /* permute pairs of pops */
      for (int i2 = 0; i2 < niter_->value(); i2++) {
        z_pos_->set_value(0);

        (*psam2_)[0] = 0;
        (*psam2_)[1] = 0;

        for (int x = 0; x < npops_->value()-1 - !outgroup_presence_->value(); x++) {
          (*nsam2_)[0] = (*vint_perpop_nsam_)[x];
          (*psam2_)[1] = (*psam2_)[0] +
                             (*vint_perpop_nsam_)[x];

          //!20160509 vint_perpop_nsam_iter_->Copy(*vint_perpop_nsam_);

          for (int y = x+1; y < npops_->value() - !outgroup_presence_->value(); y++) {
            (*nsam2_)[1] = (*vint_perpop_nsam_)[y];

            Permute_3();

            /*HERE WE ASSUME THAT THE LENGTH SIZE ARE THE SAME THAN FOR ORIGINAL SAMPLES!!*/
            (*stats_length_[1])[x]  = (*stats_length_[0])[x];
            (*stats_length2_[1])[x] = (*stats_length2_[0])[x];
            for(int yy=0;yy<npops_->value();yy++) {
                (*stats_lengthamng_[1])[x][yy] = (*stats_lengthamng_[0])[x][yy];
            }
            
            CalcPiwpiafst_3();

            if (ploidy_->value() == HAPLOID) {
              CalcHwhafsth_3();
            }

            CalcZ();

            (*psam2_)[1] += (*vint_perpop_nsam_)[y]; /*!outgroup_presence at loops*/
            z_pos_->set_value(z_pos_->value() + 1);
          }
          (*psam2_)[0] += (*vint_perpop_nsam_)[x];
        }
      }
    }

    
    PrintOutput();
    
    DeleteIterationVariables();
    
    li_->add(1);
  }
  
  if (formatfile_->value() == MS_FILE) {
    calc_mstatspop_open_ms_->Finalize();
  }
}

void CCalcMstatspop::Finalize(void) {
  // The output of this calc is printed to the screen or into a text file.
  // If it is into a text file then lets set the file name to the output of
  // this calc:
  if (calc_output_ != NULL) {
    calc_output_->set_value(file_out_->value());
  }
  
  DM_DEL_ALL_LOCAL_DATA
}


void CCalcMstatspop::ConcatenateIterationResults(void) {
  int np = 0,
      x  = 0,
      y  = 0,
      z  = 0;
  

  if(formatfile_->value() != MS_X_FILE) {
    if(outgroup_presence_->value() == 1) {
      np = npops_->value() - 1;
  
      for(x = 0; x < np; x++) {
        if((*vint_perpop_nsam_)[x] > 1) {
          (*stats_thetaSo_[0])[x] /= (*nsites2_pop_outg_)[x];                   // Theta/nt(Wat)
          (*stats_thetaTo_[0])[x] /= (*nsites2_pop_outg_)[x];                   // Theta/nt(Taj)
          (*stats_thetaFL_[0])[x] /= (*nsites2_pop_outg_)[x];                   // Theta/nt(Fu&Li)
          (*stats_thetaFW_[0])[x] /= (*nsites2_pop_outg_)[x];                   // Theta/nt(Fay&Wu)
          (*stats_thetaL_[0])[x]  /= (*nsites2_pop_outg_)[x];                   // Theta/nt(Zeng)

          if((*vint_perpop_nsam_)[x] > 2) {
            (*stats_thetaSA_[0])[x] /= (*nsites3_pop_outg_)[x];                 // Theta/nt(Achaz,Wat)
            (*stats_thetaTA_[0])[x] /= (*nsites3_pop_outg_)[x];                 // Theta/nt(Achaz,Taj)
          }

          (*stats_K_[0])[x] /= (*nsites1_pop_outg_)[x];                         //  Divergence
        }
      }
    }
    else {
      np = npops_->value()-1;
      for(x = 0; x < np; x++) {
        if((*vint_perpop_nsam_)[x] > 1) {
          (*stats_thetaS_[0])[x] /= (*nsites2_pop_)[x];                         // Theta/nt(Wat)
          (*stats_thetaT_[0])[x] /= (*nsites2_pop_)[x];                         // Theta/nt(Taj)
          (*stats_thetaFL_[0])[x] /= (*nsites2_pop_)[x];                        // Theta/nt(Fu&Li)

          if((*vint_perpop_nsam_)[x] > 2) {
            (*stats_thetaSA_[0])[x] /= (*nsites3_pop_)[x];                      // Theta/nt(Achaz,Wat)
            (*stats_thetaTA_[0])[x] /= (*nsites3_pop_)[x];                      // Theta/nt(Achaz,Taj)
          }
        }
      }
    }
  }

  /*
  if(outgroup_presence_->value() == 1) {
    np = npops_->value() - 1;
    for(x = 0; x < np; x++) {
      if((*stats_thetaT_[0])[x]-(*stats_thetaFW_[0])[x] != NA_VALUE) {
        (*stats_thetaT_[0])[x] -= (*stats_thetaFW_[0])[x];                      // Fay&WuH
      }
    }
  }


  if(npops_->value() - 1 > 1) {
    if(npops_->value() - 1 > 2) {
      if(stats_fstALL_[0]->value() > NA_VALUE) {
        if(niter_->value() && piter_niteriall_ > 0) {
          // stats_fstALL_[0]->value()                                          // Fst
          // (double)piter_iall->value()/(double)piter_niteriall_->value()      // P-value
        }
      }

      if(ploidy_->value() == HAPLOID && include_unknown_->value() == 0) {
        if(stats_fsthALL_[0]->value() > NA_VALUE) {
          if(niter_->value() && piter_niterihall_ > 0) {
          // stats_fsthALL_[0]->value()                                         // FstH
          // (double)piter_ihall->value()/(double)piter_niterihall->value()     // P-value
          }
        }
      }

      
      for(x = 0; x < npops_->value() - 1; x++) {
        if((*stats_fst1all_[0])[x] > NA_VALUE) {
          if(niter_->value() && (*piter_niteri1_)[x] > 0) {
            // (*stats_fst1all_[0])[x]                                          // Fst1
            // (double)(*piter_i1)[x]/(double)(*piter_niteri1)[x]               // P-value
          }
        }

        if(ploidy_->value() == HAPLOID && include_unknown_->value() == 0) {
          if((*stats_fsth1all_[0])[x] > NA_VALUE) {
            if(niter_->value() && (*piter_niterih1_)[x] > 0) {
              // (*stats_fsth1all_[0])[x]                                       // Fst1H
              // (double)(*piter_ih1)[x]/(double)(*piter_niterih1)[x]           // P-value
            }
          }
        }
      }
    }

    z = 0;
    for(x = 0; x < npops_->value() - 1; x++) {
      for(y = x + 1; y < npops_->value() - 0; y++) {
        if(y == npops_->value() - 1) {
          z++;
          continue;
        }
        if((*stats_fst_[0])[z] > NA_VALUE) {
          if(niter_->value() && (*piter_niteri_)[z] > 0) {
            // (*stats_fst)[z]                                                  // Fst
            // (double)(*piter_i)[z]/(double)(*piter_niteri)[z]                 // P-value
          }
        }
        z++;
      }
    }

    z = 0;
    for(x = 0; x < npops_->value() - 2; x++) {
      for(y = x + 1; y < npops_->value() - 1; y++) {
        if(y == npops_->value() - 1) {
          z++;
          continue;
        }
        if(ploidy_->value() == HAPLOID && include_unknown_->value() == 0) {
          if((*stats_fsth_[0])[z] > NA_VALUE) {
            if(niter_->value() && (*piter_niterih_)[z] > 0) {
              // (*stats_fsth)[z]                                               // FstH
              // (double)(*piter_ih)[z]/(double)(*piter_niterih)[z]             // P-value
            }
          }
        }
        z++;
      }
    }
  }
  */

  /// ==========================================================================
  /// CONCATENATE ITERARION RESULTS INTO FINAL OUTPUT DATAS
  /// ==========================================================================
  out_stats_thetaSo_->Append(*(stats_thetaSo_[0])); 
  out_stats_thetaSo_->Append(*(stats_thetaSo_[0]));       // Theta/nt(Wat) *1
  out_stats_thetaTo_->Append(*(stats_thetaTo_[0]));       // Theta/nt(Taj) *2
  out_stats_thetaFL_->Append(*(stats_thetaFL_[0]));       // Theta/nt(Fu&Li)
  out_stats_thetaFW_->Append(*(stats_thetaFW_[0]));       // Theta/nt(Fay&Wu)
  out_stats_thetaL_->Append(*(stats_thetaL_[0]));         // Theta/nt(Zeng)
  out_stats_thetaSA_->Append(*(stats_thetaSA_[0]));       // Theta/nt(Achaz,Wat)
  out_stats_thetaTA_->Append(*(stats_thetaTA_[0]));       // Theta/nt(Achaz,Taj)
  out_stats_K_->Append(*(stats_K_[0]));                   // Divergence/nt
  out_stats_thetaTHKY_->Append(*(stats_thetaTHKY_[0]));   // Theta/nt(Taj)HKY
  out_stats_KHKY_->Append(*(stats_KHKY_[0]));             // DivergenceHKY
  out_stats_thetaS_->Append(*(stats_thetaS_[0]));         // Theta/nt(Wat)  *1
  out_stats_thetaT_->Append(*(stats_thetaT_[0]));         // Theta/nt(Taj)  *2
  out_stats_hapw_->Append(*(stats_hapw_[0]));             // HapW
  out_stats_nhpop_->Append(*(stats_nhpop_[0]));           // nHap
  out_stats_Dtaj_->Append(*(stats_Dtaj_[0]));             // Tajima D
  out_stats_Dfl_->Append(*(stats_Dfl_[0]));               // Fu&Li D
  out_stats_Ffl_->Append(*(stats_Ffl_[0]));               // Fu&Li F
  out_stats_Hnfw_->Append(*(stats_Hnfw_[0]));             // Fay&Wu norm H
  out_stats_Ez_->Append(*(stats_Ez_[0]));                 // Zeng E
  out_stats_Yach_->Append(*(stats_Yach_[0]));             // Achaz Y
  out_stats_Fs_->Append(*(stats_Fs_[0]));                 // Fs
  out_stats_mdsd_->Append(*(stats_mdsd_[0]));             // SDev
  out_stats_mdg1_->Append(*(stats_mdg1_[0]));             // Skewness  
  out_stats_mdg2_->Append(*(stats_mdg2_[0]));             // Kurtosis
  out_stats_fst1all_->Append(*(stats_fst1all_[0]));       // Fst1
  out_stats_fsth_->Append(*(stats_fsth_[0]));             // FstH
  out_stats_fstHKY_->Append(*(stats_fstHKY_[0]));         // FstHKY
  out_stats_piwHKY_->Append(*(stats_piwHKY_[0]));         // PiWHKY
  out_stats_piaHKY_->Append(*(stats_piaHKY_[0]));         // PiAHKY    
}
