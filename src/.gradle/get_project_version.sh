# ===========================================================================
# Get Last Project Version
# How? from the last git commit comment
# ===========================================================================


# ------------------------------------------------------------------------------
# Attention:
# 
# The current working directory is this file's folder: ".gradle/"
# ------------------------------------------------------------------------------



# Get project version from Git
# Create a gradle file to store the value
project_version=$(git describe --abbrev=0 --tags)

# Get project revision from Git count of develop branch commits
revision=$(git rev-list --count develop)

# Create a gradle file to store the value
echo "/* Do not modify this file. It was generated by an script. */"    >  ./project_version.gradle 
echo ""                                                                 >> ./project_version.gradle 
echo "project.ext.set('PROJECT_VERSION', '$project_version.$revision')" >> ./project_version.gradle 

# Create a C++ header file for including the project version in the binary
echo "/* "                                           >  ../source/backend/language/extern.h
echo " * File:   extern.h"                           >> ../source/backend/language/extern.h
echo " * Author: ngasp_ci"                           >> ../source/backend/language/extern.h
echo " *"                                            >> ../source/backend/language/extern.h
echo " * Created on " `date`                         >> ../source/backend/language/extern.h
echo " */"                                           >> ../source/backend/language/extern.h
echo ""                                              >> ../source/backend/language/extern.h
echo "#ifndef EXTERN_H"                              >> ../source/backend/language/extern.h
echo "#define EXTERN_H"                              >> ../source/backend/language/extern.h
echo ""                                              >> ../source/backend/language/extern.h
echo "#ifdef __cplusplus"                            >> ../source/backend/language/extern.h
echo "extern \"C\" {"                                >> ../source/backend/language/extern.h
echo "#endif"                                        >> ../source/backend/language/extern.h
echo ""                                              >> ../source/backend/language/extern.h
echo "#define EXTERN_VERSION_STRING \"$project_version.$revision\""     >> ../source/backend/language/extern.h
echo ""                                              >> ../source/backend/language/extern.h
echo "#ifdef __cplusplus"                            >> ../source/backend/language/extern.h
echo "}"                                             >> ../source/backend/language/extern.h
echo "#endif"                                        >> ../source/backend/language/extern.h
echo ""                                              >> ../source/backend/language/extern.h
echo "#endif /* EXTERN_H */"                         >> ../source/backend/language/extern.h


