@echo off


REM ===========================================================================
REM Get Last Project Version
REM How? from the last git commit comment
REM ===========================================================================

IF not exist F:\tmp (mkdir F:\tmp)


REM Get project version from Git Tag
git describe --abbrev=0 --tags > F:\tmp\project_version
set /p project_version=<F:\tmp\project_version

REM Get project revision from Git count of develop branch commits
git rev-list --count develop > F:\tmp\revision
set /p revision=<F:\tmp\revision



REM Create a gradle file to store the value
(echo /* Do not modify this file. It was generated by an script. */) >  .gradle\classes\project_version.gradle 
(echo project.ext.set('PROJECT_VERSION', '%project_version%.%revision%'^) )     >> .gradle\classes\project_version.gradle 


REM Create a C++ header file for including the project version in the binary
(echo /*)                                            >  .\backend\src\language\extern.h
(echo  * File:   extern.h)                           >> .\backend\src\language\extern.h
(echo  * Author: ngasp_ci)                           >> .\backend\src\language\extern.h
(echo  *)                                            >> .\backend\src\language\extern.h
(echo  * Created on %date%)                          >> .\backend\src\language\extern.h
(echo  *)                                            >> .\backend\src\language\extern.h
(echo  */)                                           >> .\backend\src\language\extern.h
(echo.)                                              >> .\backend\src\language\extern.h
(echo #ifndef EXTERN_H)                              >> .\backend\src\language\extern.h
(echo #define EXTERN_H)                              >> .\backend\src\language\extern.h
(echo.)                                              >> .\backend\src\language\extern.h
(echo #ifdef __cplusplus)                            >> .\backend\src\language\extern.h
(echo extern "C" {)                                  >> .\backend\src\language\extern.h
(echo #endif)                                        >> .\backend\src\language\extern.h
(echo.)                                              >> .\backend\src\language\extern.h
(echo #define EXTERN_VERSION_STRING "%project_version%.%revision%") >> .\backend\src\language\extern.h
(echo.)                                              >> .\backend\src\language\extern.h
(echo #ifdef __cplusplus)                            >> .\backend\src\language\extern.h
(echo })                                             >> .\backend\src\language\extern.h
(echo #endif)                                        >> .\backend\src\language\extern.h
(echo.)                                              >> .\backend\src\language\extern.h
(echo #endif /* EXTERN_H */)                         >> .\backend\src\language\extern.h


